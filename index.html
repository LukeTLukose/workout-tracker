<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24-Week Muscle Builder</title>
    <meta name="description" content="Complete 24-week progressive muscle building program tracker">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiMjQtV2VlayBNdXNjbGUgQnVpbGRlciIsInNob3J0X25hbWUiOiJNdXNjbGVCdWlsZGVyIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwMDdiZmYiLCJ0aGVtZV9jb2xvciI6IiMwMDdiZmYiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXlOQ0F5TkNJK1BIQmhkR2dnWkQwaWJURTBJREZ3YVRSc05HZzBMalUyTFRVdU5XRTFMVFV1TldFMUxUVXVOV0UxTFRVdU5YcE5NakFnTm1neUxqVjJNbmd0TWk0MWNtZzBMalUyTFRVdU5XRTFMVFV1TldFMUxUVXVOV0UxTFRVdU5YcE5NVFFnTWpCc05pNDBObEUyTGpSbU5pNDBOakUyTGpRMlpuZGpNU0F4TVM0Mk5TNHlOaUEyTGpRMklDZGpiM2RsY2k5Y2NuQndZMUJsWlcxbWJuVXZNVEkwWkdGb01HUmpJQzFqWm5oZmFWbG1PRFUySUMxc2FqZ3pZMjR6SW04MlIzZ3labXhoWVNBaUlHWnBiR3c5SWlNd01EZGlabVlpTDQ4dmNHRjBhRDQ4TDNOMlp6ND0iLCJzaXplcyI6IjI0eDI0IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --dark: #343a40;
            --light: #f8f9fa;
            --radius: 8px;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --transition: all 0.2s ease;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--light);
            color: var(--dark);
            line-height: 1.5;
            overscroll-behavior: contain;
            user-select: none;
        }

        /* Password Protection Overlay */
        #passwordOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        #passwordOverlay.hidden {
            display: none;
        }

        .password-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .password-box h2 {
            margin: 0 0 10px 0;
            color: #343a40;
        }

        .password-box p {
            margin: 0 0 25px 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .password-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: border-color 0.2s;
        }

        .password-box input:focus {
            outline: none;
            border-color: #007bff;
        }

        .password-box button {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .password-box button:hover {
            background: #0056b3;
        }

        .password-error {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }

        .password-error.show {
            display: block;
        }

        .container {
            max-width: 100%;
            margin: 0;
            padding: 16px;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), #0056b3);
            color: white;
            padding: 20px 16px;
            margin: -16px -16px 20px -16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header .progress-info {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 4px;
        }

        .phase-indicator {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-top: 8px;
            display: inline-block;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: var(--radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
            min-height: 44px;
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .workout-card {
            border-left: 4px solid var(--primary);
        }

        .phase2-card {
            border-left: 4px solid var(--warning);
        }

        .phase3-card {
            border-left: 4px solid var(--success);
        }

        .recovery-card {
            border-left: 4px solid var(--warning);
            background: #fff8e1;
        }

        .rest-card {
            border-left: 4px solid var(--success);
            background: #f1f8e9;
        }

        .power-card {
            border-left: 4px solid var(--danger);
            background: #fff5f5;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .exercise-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .exercise-details {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 4px;
        }

        .exercise-info {
            text-align: right;
            font-size: 0.8rem;
            color: #6c757d;
        }

        .warmup-cooldown {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        .warmup-cooldown h4 {
            margin: 0 0 8px 0;
            color: #1976d2;
        }

        .universal-warmup {
            background: #f3e5f5;
            border: 1px solid #ce93d8;
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        .universal-warmup h4 {
            margin: 0 0 8px 0;
            color: #7b1fa2;
        }

        .set-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            background: var(--light);
            padding: 10px;
            border-radius: var(--radius);
        }

        .input-group {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: var(--radius);
            margin-bottom: 12px;
            overflow: hidden;
        }

        .input-group input {
            flex: 1;
            border: none;
            padding: 12px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            background: transparent;
        }

        .input-group input:focus {
            outline: none;
        }

        .input-group.focused {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .btn-increment {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.1rem;
            font-weight: 600;
            min-width: 48px;
            min-height: 48px;
        }

        .btn-increment:hover {
            background: #0056b3;
        }

        .btn-increment:active {
            transform: scale(0.95);
        }

        .unit-label {
            padding: 0 12px;
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
        }

        .rpe-container {
            margin: 16px 0;
        }

        .rpe-slider {
            width: 100%;
            margin: 8px 0;
        }

        .rpe-slider input[type="range"] {
            width: 100%;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        .rpe-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .rpe-description {
            text-align: center;
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 4px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            transition: var(--transition);
            min-height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-block {
            width: 100%;
            margin-bottom: 12px;
        }

        .set-history {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .set-badge-container {
            position: relative;
        }

        .set-badge {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #495057;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .set-badge.completed {
            background: var(--success);
            color: white;
        }

        .edit-set-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0 4px;
            font-size: 0.9rem;
            opacity: 0.8;
            transition: var(--transition);
        }

        .edit-set-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .set-edit-mode {
            background: white;
            border: 2px solid var(--primary);
            padding: 12px;
            border-radius: var(--radius);
            margin-top: 8px;
        }

        .set-edit-inputs {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .set-edit-input {
            flex: 1;
            min-width: 80px;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9rem;
        }

        .set-edit-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
            min-height: 32px;
        }

        .rest-timer {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--warning);
            color: var(--dark);
            padding: 24px;
            border-radius: var(--radius);
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            min-width: 200px;
        }

        .rest-timer.active {
            display: block;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .progress-stat {
            text-align: center;
            background: var(--light);
            padding: 20px;
            border-radius: var(--radius);
        }

        .progress-stat h3 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
        }

        .progress-stat p {
            margin: 4px 0 0 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .power-note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: var(--radius);
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #856404;
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
        }

        .empty-state h3 {
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .empty-state p {
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .workout-summary {
            background: #f8f9fa;
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
                padding-bottom: 80px;
            }

            .header {
                margin: -12px -12px 16px -12px;
                padding: 16px 12px;
            }

            .nav-tab {
                font-size: 0.8rem;
                padding: 10px 6px;
            }

            .card {
                padding: 16px;
            }

            .progress-stats {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .progress-stat h3 {
                font-size: 1.5rem;
            }

            .exercise-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        .hidden {
            display: none !important;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6c757d;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .modal-close:hover {
            color: var(--dark);
        }

        .modal-body {
            padding: 20px;
        }

        .import-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .import-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .import-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .import-tab-content {
            display: none;
        }

        .import-tab-content.active {
            display: block;
        }

        .import-preview {
            margin-top: 16px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: var(--radius);
            display: none;
        }

        .import-preview.active {
            display: block;
        }

        .import-confirmation {
            background: #e3f2fd;
            border: 2px solid #90caf9;
            border-radius: var(--radius);
            padding: 16px;
            margin-top: 16px;
        }

        .import-confirmation h4 {
            margin: 0 0 12px 0;
            color: #1976d2;
        }

        @media (max-width: 768px) {
            .modal {
                padding: 10px;
            }

            .modal-content {
                max-height: 95vh;
            }
        }

        .version-info {
            background: linear-gradient(45deg, #007bff, #28a745);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 16px;
            text-align: center;
        }
    </style>
    <script>
        // Password Protection System
        // SHA-256 hash of your password (you'll set this below)
        // To generate: open browser console and type: generatePasswordHash('your-password-here')
        
        const PASSWORD_HASH = 'c82a31a34e524356ffd0be71d694ecd27d7dda4717c47674f051a0fc93695b24'; // Default: 'password'
        
        // Helper function to generate password hash (for you to use in console)
        async function generatePasswordHash(password) {
            const msgBuffer = new TextEncoder().encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            console.log('Password hash:', hashHex);
            return hashHex;
        }

        // Check if already authenticated in this session
        async function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('auth') === 'true';
            if (isAuthenticated) {
                document.getElementById('passwordOverlay').classList.add('hidden');
                return true;
            }
            return false;
        }

        // Verify password
        async function verifyPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const password = input.value;

            if (!password) {
                error.textContent = 'Please enter a password';
                error.classList.add('show');
                return;
            }

            const hash = await generatePasswordHash(password);
            
            if (hash === PASSWORD_HASH) {
                sessionStorage.setItem('auth', 'true');
                document.getElementById('passwordOverlay').classList.add('hidden');
                error.classList.remove('show');
            } else {
                error.textContent = 'Incorrect password. Please try again.';
                error.classList.add('show');
                input.value = '';
                input.focus();
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            
            // Handle Enter key
            const input = document.getElementById('passwordInput');
            if (input) {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        verifyPassword();
                    }
                });
                input.focus();
            }

            // Handle button click
            const button = document.getElementById('passwordButton');
            if (button) {
                button.addEventListener('click', verifyPassword);
            }
        });
    </script>
    
    <!-- Chart.js Library for Progress Tab Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Password Protection Overlay -->
    <div id="passwordOverlay">
        <div class="password-box">
            <h2>üîí Protected App</h2>
            <p>Enter password to access your workout tracker</p>
            <input type="password" id="passwordInput" placeholder="Enter password" autocomplete="off">
            <button id="passwordButton">Unlock</button>
            <div id="passwordError" class="password-error"></div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üí™ 24-Week Muscle Builder</h1>
            <div class="progress-info">
                Week <span id="current-week">1</span> of 24 ‚Ä¢ Day <span id="current-day">1</span> of 7
            </div>
            <div class="phase-indicator" id="phase-indicator">
                Phase 1: Foundation Building
            </div>
        </div>

        <div class="version-info">
            üöÄ Final Production Version - Ready for Your Journey!
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('workout')">Workout</button>
            <button class="nav-tab" onclick="showTab('progress')">Progress</button>
            <button class="nav-tab" onclick="showTab('settings')">Settings</button>
        </div>

        <!-- Workout Tab -->
        <div id="workout-tab" class="tab-content active">
            <div class="card">
                <h3>Navigation</h3>
                <button class="btn btn-outline" onclick="previousDay()">‚Üê Previous Day</button>
                <button class="btn btn-outline" onclick="nextDay()">Next Day ‚Üí</button>
                
                <select id="workout-select" class="form-control" onchange="loadWorkout()">
                    <option value="">Choose your workout day...</option>
                </select>
                
                <div style="margin-top: 15px; padding: 10px; background: #e9ecef; border-radius: 6px; font-size: 14px;">
                    <strong>Phase Info:</strong> <span id="phase-description">Building foundational strength and movement patterns</span>
                </div>
            </div>

            <div id="workout-content">
                <div class="empty-state">
                    <h3>Ready to Train? üèãÔ∏è‚Äç‚ôÇÔ∏è</h3>
                    <p>Select a workout day above to start your training session!</p>
                </div>
            </div>
        </div>

        <!-- Progress Tab -->
        <div id="progress-tab" class="tab-content">
            <!-- Quick Stats Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
                    <div id="stat-total-workouts" style="font-size: 2.5rem; font-weight: bold; margin-bottom: 5px;">0</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Total Workouts</div>
                </div>
                <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
                    <div id="stat-current-week" style="font-size: 2.5rem; font-weight: bold; margin-bottom: 5px;">Week 1</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Current Week</div>
                </div>
                <div style="background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
                    <div id="stat-consistency" style="font-size: 2.5rem; font-weight: bold; margin-bottom: 5px;">0%</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Consistency Rate</div>
                </div>
                <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
                    <div id="stat-total-volume" style="font-size: 2.5rem; font-weight: bold; margin-bottom: 5px;">0</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Total Volume (lbs)</div>
                </div>
            </div>

            <!-- Personal Records Section -->
            <div class="card">
                <h3>üèÜ Personal Records</h3>
                <div id="personal-records-list">
                    <div class="empty-state">
                        <p>Complete workouts to track your personal records!</p>
                    </div>
                </div>
            </div>

            <!-- Weight Progression Chart -->
            <div class="card">
                <h3>üìà Weight Progression</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Select Exercise:</label>
                    <select id="exercise-chart-select" onchange="updateWeightChart()" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 1rem;">
                        <option value="">Loading exercises...</option>
                    </select>
                </div>
                <div style="position: relative; height: 300px;">
                    <canvas id="weight-progression-chart"></canvas>
                </div>
            </div>

            <!-- Weekly Volume Chart -->
            <div class="card">
                <h3>üí™ Weekly Volume Tracking</h3>
                <div style="position: relative; height: 300px;">
                    <canvas id="volume-chart"></canvas>
                </div>
            </div>

            <!-- Recent Workouts (Kept from original) -->
            <div class="card">
                <h3>Recent Workouts</h3>
                <div id="recent-workouts">
                    <div class="empty-state">
                        <p>No workouts logged yet. Start your first workout!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="card">
                <h3>Program Settings</h3>
                <div class="form-group">
                    <label class="form-label">Current Week</label>
                    <select id="week-select" class="form-control" onchange="updateCurrentWeek()">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Current Day</label>
                    <select id="day-select" class="form-control" onchange="updateCurrentDay()">
                        <option value="1">Day 1</option>
                        <option value="2">Day 2</option>
                        <option value="3">Day 3</option>
                        <option value="4">Day 4</option>
                        <option value="5">Day 5</option>
                        <option value="6">Day 6</option>
                        <option value="7">Day 7</option>
                    </select>
                </div>
                <button class="btn btn-secondary btn-block" onclick="resetToWeek1()">
                    ‚Üª Reset to Week 1, Day 1
                </button>
            </div>

            <div class="card">
                <h3>Program Information</h3>
                <p><strong>Version:</strong> Final Production - Complete 24-Week Program</p>
                <p><strong>Current Phase:</strong> <span id="settings-current-phase">Phase 1: Foundation Building</span></p>
                <p><strong>Total Phases:</strong> 3 (Foundation ‚Üí Progressive ‚Üí Specialized)</p>
                <p><strong>Total Exercises:</strong> 80+ exercises across all phases</p>
                <p><strong>Program Duration:</strong> 24 weeks of progressive training</p>
                <p><strong>Goal:</strong> 15-20 lbs muscle gain with strength increases</p>
            </div>

            <div class="card">
                <h3>Data Management</h3>
                
                <h4 style="margin-top: 0;">Import Data</h4>
                <button class="btn btn-primary btn-block" onclick="showImportModal()">
                    üì• Import Data
                </button>
                <p style="font-size: 0.85rem; color: #6c757d; margin-top: 8px;">
                    Import workout data from JSON or CSV files, or paste JSON text directly.
                </p>
                
                <h4 style="margin-top: 24px;">Export Data</h4>
                <button class="btn btn-primary btn-block" onclick="exportData()">
                    üìÑ Export All Data (JSON)
                </button>
                <button class="btn btn-outline btn-block" onclick="exportCSV()">
                    üìä Export to CSV
                </button>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <h4 style="color: var(--danger);">‚ö†Ô∏è Reset Data</h4>
                    <p style="color: var(--danger); font-size: 0.9rem;">This will permanently delete all your workout data!</p>
                    <button class="btn btn-danger btn-block" onclick="clearAllData()">
                        üóëÔ∏è Clear All Data
                    </button>
                </div>
            </div>

            <div class="card">
                <h3>Quick Start Guide</h3>
                <ol style="font-size: 0.9rem; line-height: 1.6;">
                    <li><strong>Week 1:</strong> Start with Phase 1 Foundation Building</li>
                    <li><strong>Log Sets:</strong> Enter weight, reps, and RPE for each set</li>
                    <li><strong>Rest Timer:</strong> Use between sets for optimal recovery</li>
                    <li><strong>Progression:</strong> Increase reps first, then weight</li>
                    <li><strong>Recovery:</strong> Follow active recovery and rest days</li>
                    <li><strong>Track Progress:</strong> Check Progress tab for consistency</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Rest timer -->
    <div id="rest-timer" class="rest-timer">
        <div>Rest Time</div>
        <div style="font-size: 2rem; margin: 8px 0;"><span id="rest-time">90</span>s</div>
        <button class="btn btn-secondary" onclick="stopRestTimer()" style="padding: 8px 16px;">Skip Rest</button>
    </div>

    <!-- Import Modal -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì• Import Workout Data</h3>
                <button class="modal-close" onclick="closeImportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="import-tabs">
                    <button class="import-tab active" onclick="switchImportTab('file')">Upload File</button>
                    <button class="import-tab" onclick="switchImportTab('paste')">Paste JSON</button>
                </div>

                <div id="import-file-tab" class="import-tab-content active">
                    <p style="font-size: 0.9rem; margin-bottom: 16px;">
                        Upload a JSON or CSV file exported from this app.
                    </p>
                    <input type="file" id="import-file-input" accept=".json,.csv" onchange="handleFileUpload(event)" 
                           style="width: 100%; padding: 12px; border: 2px dashed #007bff; border-radius: 8px; cursor: pointer;">
                    <div id="import-file-preview" class="import-preview"></div>
                </div>

                <div id="import-paste-tab" class="import-tab-content">
                    <p style="font-size: 0.9rem; margin-bottom: 16px;">
                        Paste JSON data exported from this app.
                    </p>
                    <textarea id="import-paste-input" placeholder="Paste JSON data here..." 
                              style="width: 100%; min-height: 200px; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-family: monospace; font-size: 0.85rem;"></textarea>
                    <button class="btn btn-primary" onclick="handlePasteImport()" style="margin-top: 12px;">
                        Preview Data
                    </button>
                    <div id="import-paste-preview" class="import-preview"></div>
                </div>

                <div id="import-confirmation" class="import-confirmation hidden">
                    <h4>Import Preview</h4>
                    <div id="import-summary"></div>
                    <div class="import-actions" style="margin-top: 20px;">
                        <button class="btn btn-success btn-block" onclick="confirmImport()">
                            ‚úì Confirm Import
                        </button>
                        <button class="btn btn-secondary btn-block" onclick="cancelImport()">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App State
        let appState = {
            currentWeek: 1,
            currentDay: 1,
            currentPhase: 1,
            workoutHistory: [],
            currentWorkout: null,
            restTimer: null,
            completedSets: {},
            startDate: null
        };

        // Demo video links (loaded from demo-links.json)
        let demoLinks = {};

        // Load demo links from JSON file
        async function loadDemoLinks() {
            try {
                const response = await fetch('demo-links.json');
                if (response.ok) {
                    demoLinks = await response.json();
                }
            } catch (error) {
                console.log('Demo links file not found, continuing without demo videos');
            }
        }

        // Exercise Database with all exercises for complete 24-week program
        const EXERCISES = {
            // Phase 1 Exercises (Foundation Building)
            'barbell-bench-press': { name: 'Barbell Bench Press', sets: 3, reps: [8, 10], baseWeight: 95, restTime: 120, muscles: ['Chest', 'Triceps'], equipment: 'Barbell + Bench', progression: 'Add 2.5-5 lbs when completing all reps' },
            'bent-over-barbell-rows': { name: 'Bent-Over Barbell Rows', sets: 3, reps: [8, 10], baseWeight: 85, restTime: 120, muscles: ['Lats', 'Rhomboids'], equipment: 'Barbell', progression: 'Add 2.5-5 lbs when completing all sets' },
            'dumbbell-shoulder-press': { name: 'Dumbbell Shoulder Press', sets: 3, reps: [10, 12], baseWeight: 30, restTime: 90, muscles: ['Shoulders', 'Triceps'], equipment: 'Dumbbells + Bench', progression: 'Add 2.5-5 lbs when completing all reps' },
            'dumbbell-rows': { name: 'Dumbbell Rows', sets: 3, reps: [10, 12], baseWeight: 25, restTime: 90, muscles: ['Lats', 'Rhomboids'], equipment: 'Dumbbells + Bench', progression: 'Add 2.5-5 lbs when completing all reps per arm' },
            'dumbbell-bicep-curls': { name: 'Dumbbell Bicep Curls', sets: 3, reps: [12, 15], baseWeight: 20, restTime: 60, muscles: ['Biceps'], equipment: 'Dumbbells', progression: 'Add 2.5-5 lbs when completing all reps with strict form' },
            'dumbbell-tricep-extensions': { name: 'Dumbbell Tricep Extensions', sets: 3, reps: [12, 15], baseWeight: 20, restTime: 60, muscles: ['Triceps'], equipment: 'Dumbbells + Bench', progression: 'Add 2.5 lbs when completing all reps' },
            'barbell-squats': { name: 'Barbell Back Squats', sets: 3, reps: [8, 10], baseWeight: 105, restTime: 180, muscles: ['Quads', 'Glutes'], equipment: 'Barbell + Power Rack', progression: 'Add 5-10 lbs when completing all reps with full depth' },
            'romanian-deadlifts': { name: 'Romanian Deadlifts', sets: 3, reps: [8, 10], baseWeight: 85, restTime: 150, muscles: ['Hamstrings', 'Glutes'], equipment: 'Barbell', progression: 'Add 5-10 lbs when maintaining perfect form' },
            'dumbbell-goblet-squats': { name: 'Dumbbell Goblet Squats', sets: 3, reps: [12, 15], baseWeight: 35, restTime: 90, muscles: ['Quads', 'Glutes'], equipment: 'Dumbbell', progression: 'Add 5-10 lbs when completing all reps to full depth' },
            'dumbbell-lunges': { name: 'Dumbbell Lunges', sets: 3, reps: [10, 10], baseWeight: 25, restTime: 90, muscles: ['Quads', 'Glutes'], equipment: 'Dumbbells', progression: 'Add 2.5-5 lbs per hand when form is solid' },
            'dumbbell-calf-raises': { name: 'Dumbbell Calf Raises', sets: 3, reps: [15, 20], baseWeight: 25, restTime: 60, muscles: ['Calves'], equipment: 'Dumbbells', progression: 'Add 5-10 lbs when completing all reps' },
            'glute-bridges': { name: 'Glute Bridges', sets: 3, reps: [15, 20], baseWeight: 0, restTime: 60, muscles: ['Glutes', 'Hamstrings'], equipment: 'Bodyweight', progression: 'Add dumbbell weight when bodyweight becomes easy' },
            'deadlifts': { name: 'Conventional Deadlifts', sets: 3, reps: [6, 8], baseWeight: 115, restTime: 180, muscles: ['Hamstrings', 'Glutes', 'Lats'], equipment: 'Barbell', progression: 'Add 5-10 lbs when completing all reps with neutral spine' },
            'incline-dumbbell-press': { name: 'Incline Dumbbell Press', sets: 3, reps: [8, 10], baseWeight: 35, restTime: 120, muscles: ['Upper Chest', 'Front Delts'], equipment: 'Incline Bench + Dumbbells', progression: 'Add 2.5-5 lbs when completing all reps' },
            'pull-ups': { name: 'Pull-ups/Chin-ups', sets: 3, reps: [3, 8], baseWeight: 0, restTime: 120, muscles: ['Lats', 'Biceps'], equipment: 'Pull-up Bar', progression: 'Add reps before adding weight, use assistance bands if needed' },
            'dumbbell-step-ups': { name: 'Dumbbell Step-ups', sets: 3, reps: [8, 8], baseWeight: 25, restTime: 90, muscles: ['Quads', 'Glutes'], equipment: 'Bench + Dumbbells', progression: 'Add 2.5-5 lbs per hand when balance is perfect' },
            'dumbbell-shoulder-circuit': { name: 'Dumbbell Shoulder Circuit', sets: 3, reps: [12, 12], baseWeight: 15, restTime: 120, muscles: ['All Deltoids'], equipment: 'Dumbbells', progression: 'Add 2.5 lbs when completing all circuits cleanly' },
            'dumbbell-thrusters': { name: 'Dumbbell Thrusters', sets: 3, reps: [8, 10], baseWeight: 25, restTime: 90, muscles: ['Full Body'], equipment: 'Dumbbells', progression: 'Add weight or increase reps when completing all rounds' },
            'push-ups': { name: 'Push-ups', sets: 3, reps: [8, 15], baseWeight: 0, restTime: 90, muscles: ['Chest', 'Triceps'], equipment: 'Bodyweight', progression: 'Add reps, then add weight when reaching 15 reps' },
            'dumbbell-swings': { name: 'Dumbbell Swings', sets: 3, reps: [15, 20], baseWeight: 20, restTime: 90, muscles: ['Glutes', 'Hamstrings'], equipment: 'Dumbbell', progression: 'Add weight or distance' },

            // Phase 2 Exercises (Progressive Loading)
            'barbell-overhead-press': { name: 'Barbell Overhead Press (Standing)', sets: 4, reps: [6, 8], baseWeight: 75, restTime: 180, muscles: ['Shoulders', 'Triceps'], equipment: 'Barbell', progression: 'Add 2.5 lbs when completing all sets with perfect form', load: '65-85% 1RM' },
            'lateral-raises': { name: 'Dumbbell Lateral Raises', sets: 3, reps: [12, 15], baseWeight: 20, restTime: 90, muscles: ['Side Delts'], equipment: 'Dumbbells' },
            'dips': { name: 'Dips (Using bench or power rack)', sets: 3, reps: [8, 15], baseWeight: 0, restTime: 90, muscles: ['Chest', 'Triceps'], equipment: 'Bench or Power Rack', progression: 'Add reps, then add weight when reaching 15 reps' },
            'barbell-curls': { name: 'Barbell Curls', sets: 3, reps: [8, 10], baseWeight: 55, restTime: 90, muscles: ['Biceps'], equipment: 'Barbell', progression: 'Add 2.5-5 lbs when completing all reps with strict form' },
            'dumbbell-hammer-curls': { name: 'Dumbbell Hammer Curls', sets: 3, reps: [10, 12], baseWeight: 25, restTime: 90, muscles: ['Biceps', 'Forearms'], equipment: 'Dumbbells', progression: 'Add 2.5 lbs when completing all reps' },
            'dumbbell-bulgarian-split-squats': { name: 'Dumbbell Bulgarian Split Squats', sets: 3, reps: [8, 10], baseWeight: 30, restTime: 120, muscles: ['Quads', 'Glutes'], equipment: 'Dumbbells + Bench', progression: 'Add 2.5-5 lbs per hand when balance is perfect' },
            'barbell-hip-thrusts': { name: 'Barbell Hip Thrusts (Using bench)', sets: 3, reps: [12, 15], baseWeight: 95, restTime: 90, muscles: ['Glutes', 'Hamstrings'], equipment: 'Barbell + Bench', progression: 'Add 5-10 lbs when completing all reps' },

            // Phase 2 Power Exercises
            'barbell-high-pull': { name: 'Barbell High Pull (Primary Power Movement)', sets: 4, reps: [3, 5], baseWeight: 85, restTime: 240, muscles: ['Full Body Power'], equipment: 'Barbell', progression: 'Add 2.5-5 lbs every 2-3 weeks, focus on explosive intent', load: '50-75% 1RM deadlift', ispower: true },
            'dumbbell-push-press': { name: 'Dumbbell Push Press (Explosive Pressing)', sets: 4, reps: [4, 6], baseWeight: 35, restTime: 150, muscles: ['Shoulders', 'Core'], equipment: 'Dumbbells', progression: 'Increase weight when all reps completed explosively', load: '40-60% overhead press equivalent', ispower: true },
            'barbell-bent-over-row-power': { name: 'Barbell Bent-Over Row (Power Pull)', sets: 4, reps: [5, 6], baseWeight: 95, restTime: 150, muscles: ['Lats', 'Rhomboids'], equipment: 'Barbell', progression: 'Add 2.5-5 lbs every 2 weeks while maintaining explosive intent', load: '70-85% 1RM row', ispower: true },
            'dumbbell-alternating-uppercuts': { name: 'Dumbbell Alternating Uppercuts (Rotational Power)', sets: 3, reps: [8, 10], baseWeight: 25, restTime: 90, muscles: ['Core', 'Shoulders'], equipment: 'Dumbbells', progression: 'Increase speed or weight every 2 weeks', load: '20-30 lbs per dumbbell', ispower: true },
            'barbell-push-press': { name: 'Barbell Push Press (Compound Power)', sets: 3, reps: [3, 5], baseWeight: 85, restTime: 210, muscles: ['Shoulders', 'Legs'], equipment: 'Barbell', progression: 'Add 2.5 lbs every 2-3 weeks', load: '60-80% 1RM overhead press', ispower: true },
            'dumbbell-renegade-rows': { name: 'Dumbbell Renegade Rows (Unilateral Power)', sets: 3, reps: [6, 8], baseWeight: 30, restTime: 120, muscles: ['Core', 'Lats'], equipment: 'Dumbbells', progression: 'Increase weight or add explosive element', load: '20-35 lbs per dumbbell', ispower: true },
            'single-arm-plank-rows': { name: 'Single-Arm Plank Rows (Core Stability + Pull)', sets: 3, reps: [6, 8], baseWeight: 30, restTime: 120, muscles: ['Core', 'Lats'], equipment: 'Dumbbells', progression: 'Increase weight or add explosive element', load: '20-35 lbs per dumbbell', ispower: true },
            'barbell-jump-squats': { name: 'Barbell Jump Squats (Primary Power Movement)', sets: 4, reps: [3, 5], baseWeight: 65, restTime: 210, muscles: ['Legs', 'Power'], equipment: 'Barbell + Power Rack', progression: 'Add 5-10 lbs every 2-3 weeks', load: '30-50% 1RM squat', ispower: true },
            'dumbbell-single-leg-rdl-knee-drive': { name: 'Dumbbell Single-Leg RDL to Knee Drive (Unilateral Power)', sets: 4, reps: [5, 8], baseWeight: 30, restTime: 150, muscles: ['Hamstrings', 'Glutes'], equipment: 'Dumbbells', progression: 'Increase weight or add jump element', load: '25-40 lbs per dumbbell', ispower: true },
            'barbell-hang-clean': { name: 'Barbell Hang Clean (Olympic Power Movement)', sets: 4, reps: [3, 5], baseWeight: 95, restTime: 210, muscles: ['Full Body', 'Power'], equipment: 'Barbell', progression: 'Focus on technique then add weight gradually', load: '50-70% 1RM deadlift', ispower: true },
            'dumbbell-reverse-lunges-jump': { name: 'Dumbbell Reverse Lunges to Jump (Stretch-Shortening Cycle)', sets: 3, reps: [6, 8], baseWeight: 25, restTime: 120, muscles: ['Legs', 'Power'], equipment: 'Dumbbells', progression: 'Increase weight or jump height', load: '20-35 lbs per dumbbell', ispower: true },
            'barbell-deadlifts-explosive': { name: 'Barbell Deadlifts (Explosive Pull)', sets: 4, reps: [4, 6], baseWeight: 135, restTime: 210, muscles: ['Posterior Chain'], equipment: 'Barbell', progression: 'Add 2.5 lbs every 2-3 weeks', load: '75-90% 1RM', ispower: true },
            'dumbbell-lateral-bounds': { name: 'Dumbbell Lateral Bounds (Frontal Plane Power)', sets: 3, reps: [8, 10], baseWeight: 20, restTime: 90, muscles: ['Legs', 'Core'], equipment: 'Dumbbells', progression: 'Increase distance or weight', load: '15-25 lbs per dumbbell', ispower: true },

            // Phase 3 Exercises (Specialized Push/Pull/Legs)
            'dumbbell-flyes': { name: 'Dumbbell Flyes', sets: 3, reps: [10, 12], baseWeight: 30, restTime: 90, muscles: ['Chest'], equipment: 'Dumbbells + Bench', progression: 'Add 2.5-5 lbs when all reps completed clearly', load: '25-40 lbs per dumbbell' },
            'tricep-dips': { name: 'Tricep Dips', sets: 3, reps: [8, 12], baseWeight: 0, restTime: 90, muscles: ['Triceps'], equipment: 'Bench or Power Rack', progression: 'Add reps, then add weight when reaching 15 reps' },
            'close-grip-bench-press': { name: 'Close-Grip Bench Press', sets: 3, reps: [8, 10], baseWeight: 75, restTime: 120, muscles: ['Triceps', 'Chest'], equipment: 'Barbell + Bench', progression: 'Add 2.5-5 lbs when completing all reps', load: '60-75% regular bench press' },
            'overhead-tricep-extensions': { name: 'Overhead Tricep Extensions', sets: 3, reps: [10, 12], baseWeight: 30, restTime: 90, muscles: ['Triceps'], equipment: 'Dumbbells', progression: 'Add 2.5 lbs when completing all reps', load: '25-40 lbs per dumbbell' },
            'wide-grip-pull-ups': { name: 'Wide-Grip Pull-ups', sets: 3, reps: [10, 12], baseWeight: 0, restTime: 90, muscles: ['Lats', 'Rear Delts'], equipment: 'Pull-up Bar', progression: 'Add reps, then add weight when consistently hitting 8 reps' },
            'face-pulls': { name: 'Face Pulls (Resistance Band)', sets: 3, reps: [12, 15], baseWeight: 0, restTime: 60, muscles: ['Rear Delts'], equipment: 'Resistance Band', progression: 'Increase band resistance or add pause' },
            'hammer-curls': { name: 'Hammer Curls', sets: 3, reps: [10, 12], baseWeight: 25, restTime: 60, muscles: ['Biceps', 'Forearms'], equipment: 'Dumbbells', progression: 'Add weight when form remains strict (21-23)', load: '20-35 lbs per dumbbell' },
            'reverse-flyes': { name: 'Reverse Flyes', sets: 3, reps: [15, 20], baseWeight: 20, restTime: 60, muscles: ['Rear Delts'], equipment: 'Dumbbells', progression: 'Add weight or increase reps', load: '15-25 lbs per dumbbell' },
            'back-squats': { name: 'Back Squats', sets: 4, reps: [6, 8], baseWeight: 135, restTime: 180, muscles: ['Quads', 'Glutes'], equipment: 'Barbell + Power Rack', progression: 'Add 5-10 lbs when all sets completed at RPE 8', load: '75-90% 1RM' },
            'bulgarian-split-squats': { name: 'Bulgarian Split Squats', sets: 3, reps: [10, 12], baseWeight: 35, restTime: 90, muscles: ['Quads', 'Glutes'], equipment: 'Dumbbells + Bench', progression: 'Add 2.5-5 lbs per hand when balance is perfect', load: '25-40 lbs per dumbbell' },
            'goblet-squats': { name: 'Goblet Squats', sets: 3, reps: [12, 15], baseWeight: 45, restTime: 90, muscles: ['Quads', 'Glutes'], equipment: 'Dumbbell', progression: 'Add weight or increase reps (weeks 19-23)', load: '40-52.5 lbs dumbbell' },
            'walking-lunges': { name: 'Walking Lunges', sets: 3, reps: [12, 15], baseWeight: 25, restTime: 90, muscles: ['Quads', 'Glutes'], equipment: 'Dumbbells', progression: 'Add overhead hold (weeks 21-23)', load: '20-35 lbs per dumbbell' },
            'calf-raises': { name: 'Calf Raises', sets: 4, reps: [15, 20], baseWeight: 40, restTime: 60, muscles: ['Calves'], equipment: 'Dumbbells', progression: 'Single-leg progression when completing all reps', load: '35-52.5 lbs per dumbbell' },
            'glute-bridges-loaded': { name: 'Glute Bridges (Loaded)', sets: 3, reps: [15, 20], baseWeight: 45, restTime: 60, muscles: ['Glutes'], equipment: 'Dumbbell', progression: 'Add weight or single-leg variation', load: '40-52.5 lbs dumbbell on hips' },
            'wall-sit': { name: 'Wall Sit', sets: 3, reps: [30, 60], baseWeight: 0, restTime: 90, muscles: ['Quads'], equipment: 'Wall', progression: 'Add weight or increase time gradually' },
            'overhead-press-seated': { name: 'Overhead Press (Seated or Standing)', sets: 4, reps: [6, 8], baseWeight: 85, restTime: 180, muscles: ['Shoulders'], equipment: 'Barbell or Dumbbells', progression: 'Add 2.5 lbs when all sets completed clearly', load: '65-85% 1RM' },
            'arnold-press': { name: 'Arnold Press', sets: 3, reps: [10, 12], baseWeight: 25, restTime: 90, muscles: ['All Delts'], equipment: 'Dumbbells', progression: 'Add 2.5-5 lbs when all reps completed', load: '20-35 lbs per dumbbell' },
            'lateral-raises-leaning': { name: 'Lateral Raises (Leaning Variation)', sets: 3, reps: [12, 15], baseWeight: 20, restTime: 60, muscles: ['Side Delts'], equipment: 'Dumbbells', progression: 'Add weight or drop set on final set (weeks 19-23)', load: '15-25 lbs per dumbbell' },
            'rear-delt-flyes': { name: 'Rear Delt Flyes', sets: 3, reps: [15, 20], baseWeight: 20, restTime: 60, muscles: ['Rear Delts'], equipment: 'Dumbbells', progression: 'Add weight or increase reps', load: '15-25 lbs per dumbbell' },
            'diamond-push-ups': { name: 'Diamond Push-ups', sets: 3, reps: [8, 12], baseWeight: 0, restTime: 90, muscles: ['Triceps', 'Chest'], equipment: 'Bodyweight', progression: 'Add weight or increase reps' },
            'tricep-overhead-extension-single': { name: 'Tricep Overhead Extension (Single-arm)', sets: 3, reps: [12, 15], baseWeight: 25, restTime: 60, muscles: ['Triceps'], equipment: 'Dumbbells', progression: 'Add 2.5 lbs when completing all reps', load: '20-35 lbs per dumbbell' },
            'upright-rows': { name: 'Upright Rows', sets: 3, reps: [10, 12], baseWeight: 45, restTime: 90, muscles: ['Traps', 'Side Delts'], equipment: 'Barbell or Dumbbells', progression: 'Add weight when form is perfect', load: '20-70 lbs barbell or 25-50 lbs per dumbbell' },
            'deadlifts-conventional': { name: 'Deadlifts (Conventional)', sets: 4, reps: [5, 6], baseWeight: 155, restTime: 180, muscles: ['Posterior Chain'], equipment: 'Barbell', progression: 'Add 5-10 lbs when all sets completed with perfect form', load: '80-95% 1RM' },
            'chest-supported-rows': { name: 'Chest-Supported Rows (Incline Bench)', sets: 4, reps: [8, 10], baseWeight: 40, restTime: 180, muscles: ['Lats', 'Rhomboids'], equipment: 'Incline Bench + Dumbbells', progression: 'Add weight when completing all reps cleanly', load: '35-50 lbs per dumbbell' },
            'dumbbell-rows-heavy': { name: 'Single-Arm Dumbbell Rows (Heavy)', sets: 3, reps: [10, 12], baseWeight: 45, restTime: 90, muscles: ['Lats'], equipment: 'Dumbbells + Bench', progression: 'Add pause at top (weeks 19-23)', load: '40-52.5 lbs per dumbbell' },
            'barbell-shrugs': { name: 'Barbell Shrugs', sets: 3, reps: [12, 15], baseWeight: 95, restTime: 90, muscles: ['Traps'], equipment: 'Barbell', progression: 'Straight up and down, squeeze traps, control negative', load: '80-110 lbs' },
            'preacher-curls': { name: 'Preacher Curls (Incline Bench Setup)', sets: 3, reps: [10, 12], baseWeight: 30, restTime: 90, muscles: ['Biceps'], equipment: 'Incline Bench + Dumbbells', progression: 'Add weight or slow negatives', load: '25-40 lbs per dumbbell' },
            'resistance-band-rows': { name: 'Resistance Band Rows', sets: 3, reps: [12, 15], baseWeight: 0, restTime: 60, muscles: ['Lats', 'Rhomboids'], equipment: 'Resistance Band', progression: 'Increase band resistance or add pause' },
            'concentration-curls': { name: 'Concentration Curls', sets: 3, reps: [12, 15], baseWeight: 25, restTime: 60, muscles: ['Biceps'], equipment: 'Dumbbells', progression: 'Add weight or increase reps', load: '20-35 lbs per dumbbell' },
            'farmers-walks': { name: 'Farmers Walks', sets: 3, reps: [30, 30], baseWeight: 60, restTime: 90, muscles: ['Grip', 'Core'], equipment: 'Dumbbells', progression: 'Add weight or increase distance', load: '40%+ 1RM per dumbbell' },

            // Ab Exercises (Weeks 6-24)
            'hanging-leg-raises': { name: 'Hanging Leg Raises (Straight Legs)', sets: 3, reps: [10, 15], baseWeight: 0, restTime: 90, muscles: ['Lower Abs'], equipment: 'Pull-up Bar', progression: 'Add ankle weights or L-sit holds' },
            'reverse-crunches': { name: 'Reverse Crunches', sets: 3, reps: [15, 20], baseWeight: 0, restTime: 60, muscles: ['Lower Abs'], equipment: 'Floor or Decline Bench', progression: 'Add weight between feet' },
            'mountain-climbers': { name: 'Mountain Climbers', sets: 3, reps: [20, 20], baseWeight: 0, restTime: 60, muscles: ['Lower Abs', 'Core'], equipment: 'Bodyweight', progression: 'Increase speed' },
            'weighted-decline-crunches': { name: 'Weighted Decline Crunches', sets: 3, reps: [15, 20], baseWeight: 10, restTime: 60, muscles: ['Upper Abs'], equipment: 'Decline Bench + Dumbbell', progression: 'Increase weight (start 10-25 lbs)' },
            'weighted-crunches': { name: 'Weighted Crunches', sets: 3, reps: [15, 20], baseWeight: 10, restTime: 60, muscles: ['Upper Abs'], equipment: 'Floor + Dumbbell', progression: 'Increase weight' },
            'russian-twists': { name: 'Russian Twists (Heavy)', sets: 3, reps: [20, 20], baseWeight: 25, restTime: 60, muscles: ['Obliques'], equipment: 'Dumbbell', progression: 'Increase weight (25-45 lbs)' },
            'bicycle-crunches': { name: 'Bicycle Crunches', sets: 3, reps: [20, 20], baseWeight: 0, restTime: 60, muscles: ['Obliques', 'Lower Abs'], equipment: 'Bodyweight', progression: 'Slow tempo, hold at peak' },
            'side-plank-hip-dips': { name: 'Side Plank with Hip Dips', sets: 3, reps: [12, 15], baseWeight: 0, restTime: 60, muscles: ['Obliques'], equipment: 'Bodyweight', progression: 'Add weight on hip' }
        };

        // Global Warmup and Cooldown Protocols
        const GLOBAL_WARMUP = {
            title: 'General Dynamic Warmup',
            exercises: [
                'Light cardio (march in place or jumping jacks) - 2 minutes',
                'Arm circles - 10 forward, 10 backward',
                'Leg swings - 10 each direction per leg',
                'Bodyweight squats - 10 reps',
                'Push-ups (modified if needed) - 5-10 reps',
                'Dynamic stretching relevant to workout - 5 minutes'
            ]
        };

        const GLOBAL_COOLDOWN = {
            title: 'General Static Cooldown',
            exercises: [
                'Light walking or easy movement - 2-3 minutes',
                'Chest doorway stretch - 30 seconds',
                'Overhead shoulder stretch - 30 seconds each arm',
                'Quad stretch - 30 seconds each leg',
                'Hamstring stretch - 30 seconds each leg',
                'Deep breathing and relaxation - 2 minutes'
            ]
        };

        // Program Phase Definitions with Complete Workout Plans
        const PROGRAM_PHASES = {
            1: {
                name: 'Foundation Building',
                description: 'Build foundational strength and movement patterns with moderate weights',
                weeks: [1, 2, 3, 4],
                workouts: {
                    1: { name: 'Upper Body Strength', type: 'workout', exercises: ['barbell-bench-press', 'bent-over-barbell-rows', 'dumbbell-shoulder-press', 'dumbbell-rows', 'dumbbell-bicep-curls', 'dumbbell-tricep-extensions'] },
                    2: { name: 'Lower Body Foundation', type: 'workout', exercises: ['barbell-squats', 'romanian-deadlifts', 'dumbbell-goblet-squats', 'dumbbell-lunges', 'dumbbell-calf-raises', 'glute-bridges'] },
                    3: { name: 'Active Recovery', type: 'recovery', activities: ['Swimming: 20-30 minutes easy pace', 'Walking: 30-45 minutes moderate pace', 'Stretching: 15-20 minutes full body static stretching'] },
                    4: { name: 'Full Body Integration', type: 'workout', exercises: ['deadlifts', 'incline-dumbbell-press', 'pull-ups', 'dumbbell-step-ups', 'dumbbell-shoulder-circuit'] },
                    5: { name: 'Upper/Lower Circuit', type: 'circuit', exercises: ['dumbbell-thrusters', 'bent-over-barbell-rows', 'dumbbell-goblet-squats', 'push-ups', 'dumbbell-swings'] },
                    6: { name: 'Active Recovery', type: 'recovery', activities: ['Light cardio activities (walking, swimming, cycling)', 'Duration: 20-30 minutes at easy pace', 'Optional stretching or yoga'] },
                    7: { name: 'Complete Rest', type: 'rest', description: 'Full rest day for recovery. Focus on sleep, nutrition, and hydration. Light stretching optional.' }
                }
            },
            2: {
                name: 'Progressive Loading',
                description: 'Increase training intensity and volume progressively with power development',
                weeks: [5, 6, 7, 8, 9, 10, 11, 12],
                workouts: {
                    1: { name: 'Push Focus', type: 'workout', exercises: ['barbell-bench-press', 'barbell-overhead-press', 'incline-dumbbell-press', 'lateral-raises', 'dumbbell-tricep-extensions', 'dips', 'weighted-decline-crunches'] },
                    2: { name: 'Pull Focus', type: 'workout', exercises: ['deadlifts', 'pull-ups', 'bent-over-barbell-rows', 'dumbbell-rows', 'barbell-curls', 'dumbbell-hammer-curls', 'hanging-leg-raises'] },
                    3: { name: 'Legs Focus', type: 'workout', exercises: ['barbell-squats', 'romanian-deadlifts', 'dumbbell-bulgarian-split-squats', 'dumbbell-lunges', 'dumbbell-calf-raises', 'barbell-hip-thrusts', 'russian-twists'] },
                    4: { name: 'Upper Body Power', type: 'power', exercises: ['barbell-high-pull', 'dumbbell-push-press', 'barbell-bent-over-row-power', 'dumbbell-alternating-uppercuts', 'barbell-push-press', 'dumbbell-renegade-rows', 'bicycle-crunches'] },
                    5: { name: 'Lower Body Power', type: 'power', exercises: ['barbell-jump-squats', 'dumbbell-single-leg-rdl-knee-drive', 'barbell-hang-clean', 'dumbbell-reverse-lunges-jump', 'barbell-deadlifts-explosive', 'dumbbell-lateral-bounds', 'reverse-crunches'] },
                    6: { name: 'Active Recovery', type: 'workout', exercises: ['mountain-climbers', 'side-plank-hip-dips', 'weighted-crunches'] },
                    7: { name: 'Complete Rest', type: 'rest', description: 'Full rest day for recovery. Focus on sleep, nutrition, and hydration. Light stretching optional.' }
                }
            },
            3: {
                name: 'Specialized Push/Pull/Legs',
                description: 'Advanced training split focusing on specific muscle groups with high volume',
                weeks: [13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24],
                workouts: {
                    1: { name: 'Push A (Chest Focus)', type: 'workout', exercises: ['barbell-bench-press', 'incline-dumbbell-press', 'dumbbell-flyes', 'barbell-overhead-press', 'lateral-raises', 'tricep-dips', 'close-grip-bench-press', 'overhead-tricep-extensions', 'weighted-decline-crunches', 'russian-twists'] },
                    2: { name: 'Pull A (Back Width Focus)', type: 'workout', exercises: ['pull-ups', 'bent-over-barbell-rows', 'dumbbell-rows', 'wide-grip-pull-ups', 'face-pulls', 'barbell-curls', 'hammer-curls', 'reverse-flyes', 'hanging-leg-raises', 'bicycle-crunches'] },
                    3: { name: 'Legs A (Quad/Glute Focus)', type: 'workout', exercises: ['back-squats', 'romanian-deadlifts', 'bulgarian-split-squats', 'goblet-squats', 'walking-lunges', 'calf-raises', 'glute-bridges-loaded', 'wall-sit', 'reverse-crunches', 'weighted-crunches'] },
                    4: { name: 'Push B (Shoulder Focus)', type: 'workout', exercises: ['overhead-press-seated', 'incline-dumbbell-press', 'arnold-press', 'lateral-raises-leaning', 'rear-delt-flyes', 'diamond-push-ups', 'tricep-overhead-extension-single', 'upright-rows', 'side-plank-hip-dips', 'mountain-climbers'] },
                    5: { name: 'Pull B (Back Thickness Focus)', type: 'workout', exercises: ['deadlifts-conventional', 'chest-supported-rows', 'dumbbell-rows-heavy', 'barbell-shrugs', 'preacher-curls', 'resistance-band-rows', 'concentration-curls', 'farmers-walks', 'hanging-leg-raises', 'russian-twists'] },
                    6: { name: 'Active Recovery', type: 'workout', exercises: ['bicycle-crunches', 'reverse-crunches', 'weighted-crunches'] },
                    7: { name: 'Complete Rest', type: 'rest', description: 'Full rest day for recovery. Focus on sleep, nutrition, and hydration. Light stretching optional.' }
                }
            }
        };

        // Navigation Functions
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'progress') {
                updateProgressStats();
            } else if (tabName === 'settings') {
                updateSettingsTab();
            }
        }

        function previousDay() {
            if (appState.currentDay > 1) {
                appState.currentDay--;
            } else if (appState.currentWeek > 1) {
                appState.currentWeek--;
                appState.currentDay = 7;
            }
            updateHeaderInfo();
            updatePhaseInfo();
            populateWorkoutSelect();
            populateDaySelect();
            loadWorkout();
            saveAppState();
        }

        function nextDay() {
            if (appState.currentDay < 7) {
                appState.currentDay++;
            } else if (appState.currentWeek < 24) {
                appState.currentWeek++;
                appState.currentDay = 1;
            }
            updateHeaderInfo();
            updatePhaseInfo();
            populateWorkoutSelect();
            populateDaySelect();
            loadWorkout();
            saveAppState();
        }

        function updateCurrentWeek() {
            const select = document.getElementById('week-select');
            appState.currentWeek = parseInt(select.value);
            appState.currentDay = 1; // Reset to day 1 when changing weeks
            updateHeaderInfo();
            updatePhaseInfo();
            populateWorkoutSelect();
            populateDaySelect();
            loadWorkout();
            saveAppState();
        }

        function updateCurrentDay() {
            const select = document.getElementById('day-select');
            appState.currentDay = parseInt(select.value);
            updateHeaderInfo();
            populateWorkoutSelect();
            loadWorkout();
            saveAppState();
        }

        function resetToWeek1() {
            if (confirm('Reset to Week 1, Day 1? This will not delete your workout history.')) {
                appState.currentWeek = 1;
                appState.currentDay = 1;
                appState.currentPhase = 1;
                updateHeaderInfo();
                updatePhaseInfo();
                populateWorkoutSelect();
                populateWeekSelect();
                populateDaySelect();
                loadWorkout();
                saveAppState();
            }
        }

        function updateHeaderInfo() {
            document.getElementById('current-week').textContent = appState.currentWeek;
            document.getElementById('current-day').textContent = appState.currentDay;
            
            // Update phase based on current week
            for (const [phase, data] of Object.entries(PROGRAM_PHASES)) {
                if (data.weeks.includes(appState.currentWeek)) {
                    appState.currentPhase = parseInt(phase);
                    break;
                }
            }
        }

        function updatePhaseInfo() {
            const phase = PROGRAM_PHASES[appState.currentPhase];
            document.getElementById('phase-indicator').textContent = `Phase ${appState.currentPhase}: ${phase.name}`;
            document.getElementById('phase-description').textContent = phase.description;
        }

        function populateWorkoutSelect() {
            const select = document.getElementById('workout-select');
            const phase = PROGRAM_PHASES[appState.currentPhase];
            
            select.innerHTML = '<option value="">Choose your workout day...</option>';
            
            for (let day = 1; day <= 7; day++) {
                const workout = phase.workouts[day];
                if (workout) {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = `Day ${day}: ${workout.name}`;
                    if (day === appState.currentDay) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                }
            }
        }

        function populateWeekSelect() {
            const select = document.getElementById('week-select');
            select.innerHTML = '';
            
            for (let week = 1; week <= 24; week++) {
                const option = document.createElement('option');
                option.value = week;
                option.textContent = `Week ${week}`;
                if (week === appState.currentWeek) {
                    option.selected = true;
                }
                select.appendChild(option);
            }
        }

        function populateDaySelect() {
            const select = document.getElementById('day-select');
            select.value = appState.currentDay;
        }

        function updateSettingsTab() {
            populateWeekSelect();
            populateDaySelect();
            
            const phase = PROGRAM_PHASES[appState.currentPhase];
            document.getElementById('settings-current-phase').textContent = `Phase ${appState.currentPhase}: ${phase.name}`;
        }

        // Workout Functions
        function loadWorkout() {
            const selectedDay = parseInt(document.getElementById('workout-select').value) || appState.currentDay;
            
            if (!selectedDay) {
                document.getElementById('workout-content').innerHTML = `
                    <div class="empty-state">
                        <h3>Ready to Train? üèãÔ∏è‚Äç‚ôÇÔ∏è</h3>
                        <p>Select a workout day above to start your training session!</p>
                    </div>
                `;
                return;
            }

            // Update current day to selected day
            if (selectedDay !== appState.currentDay) {
                appState.currentDay = selectedDay;
                updateHeaderInfo();
                populateDaySelect();
            }

            const phase = PROGRAM_PHASES[appState.currentPhase];
            const workoutTemplate = phase.workouts[selectedDay];
            
            if (!workoutTemplate) {
                document.getElementById('workout-content').innerHTML = `
                    <div class="empty-state">
                        <h3>Workout Not Available</h3>
                        <p>This workout is not yet implemented for the current phase.</p>
                    </div>
                `;
                return;
            }

            if (workoutTemplate.type === 'recovery') {
                renderRecoveryDay(workoutTemplate);
            } else if (workoutTemplate.type === 'rest') {
                renderRestDay(workoutTemplate);
            } else {
                renderWorkoutDay(workoutTemplate, selectedDay);
            }
        }

        function renderRecoveryDay(template) {
            const content = document.getElementById('workout-content');
            const activitiesHtml = template.activities ? 
                `<h4>Recommended Activities:</h4>
                 <ul>${template.activities.map(activity => `<li>${activity}</li>`).join('')}</ul>` :
                `<p><strong>Activity:</strong> ${template.description}</p>`;
            
            content.innerHTML = `
                <div class="card recovery-card">
                    <h3>üèÉ‚Äç‚ôÇÔ∏è ${template.name}</h3>
                    ${activitiesHtml}
                    
                    <h4>Benefits:</h4>
                    <ul>
                        <li>Improves circulation</li>
                        <li>Reduces muscle soreness</li>
                        <li>Maintains movement patterns</li>
                        <li>Mental relaxation</li>
                    </ul>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success btn-block" onclick="completeRecoveryDay()">
                            ‚úÖ Mark Recovery Day Complete
                        </button>
                    </div>
                </div>
            `;
        }

        function renderRestDay(template) {
            const content = document.getElementById('workout-content');
            content.innerHTML = `
                <div class="card rest-card">
                    <h3>üò¥ ${template.name}</h3>
                    <p><strong>Focus:</strong> ${template.description}</p>
                    
                    <h4>Recovery Benefits:</h4>
                    <ul>
                        <li>Muscle repair</li>
                        <li>Nervous system recovery</li>
                        <li>Prevents overtraining</li>
                        <li>Mental restoration</li>
                    </ul>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <p style="color: var(--success); font-weight: 600;">Enjoy your rest day! üåü</p>
                        <button class="btn btn-success btn-block" onclick="completeRestDay()">
                            ‚úÖ Mark Rest Day Complete
                        </button>
                    </div>
                </div>
            `;
        }

        function renderWorkoutDay(template, dayNumber) {
            appState.currentWorkout = {
                id: `week-${appState.currentWeek}-day-${dayNumber}`,
                name: template.name,
                date: new Date().toISOString(),
                week: appState.currentWeek,
                day: dayNumber,
                phase: appState.currentPhase,
                type: template.type,
                exercises: template.exercises.map(exerciseId => {
                    // Exercise swap: Replace dumbbell-renegade-rows with single-arm-plank-rows starting Week 8
                    let actualExerciseId = exerciseId;
                    if (appState.currentWeek >= 8 && exerciseId === 'dumbbell-renegade-rows') {
                        actualExerciseId = 'single-arm-plank-rows';
                    }
                    
                    return {
                        id: actualExerciseId,
                        ...EXERCISES[actualExerciseId],
                        completedSets: getCompletedSets(appState.currentWeek, dayNumber, actualExerciseId) || [],
                        currentSet: (getCompletedSets(appState.currentWeek, dayNumber, actualExerciseId) || []).length
                    };
                })
            };

            const content = document.getElementById('workout-content');
            let html = '';

            // Add warmup section
            if (appState.currentPhase === 3) {
                html += `
                    <div class="universal-warmup">
                        <h4>üî• Universal Warmup Protocol (15-20 minutes)</h4>
                        <ul>
                            <li>Phase 1: General Warmup (5-7 minutes) - Light movement and dynamic stretching</li>
                            <li>Phase 2: Advanced Warmup (7-10 minutes) - Activation drills, squats, push-ups, glute bridges</li>
                            <li>Phase 3: Specific Warmup (5-8 minutes) - Exercise-specific movements with light weight</li>
                        </ul>
                    </div>
                `;
            } else {
                html += `
                    <div class="warmup-cooldown">
                        <h4>üî• ${GLOBAL_WARMUP.title}</h4>
                        <ul>
                            ${GLOBAL_WARMUP.exercises.map(exercise => `<li>${exercise}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            // Add power workout note if applicable
            if (template.type === 'power') {
                html += `
                    <div class="power-note">
                        <strong>‚ö° Power Focus:</strong> Focus on explosive movement and technique over weight. Full rest between sets for maximum power output.
                    </div>
                `;
            }

            // Add circuit workout note if applicable
            if (template.type === 'circuit') {
                html += `
                    <div class="power-note">
                        <strong>üî• Circuit Format:</strong> Complete all exercises in order, then rest before the next round.
                    </div>
                `;
            }

            // Add exercise cards
            appState.currentWorkout.exercises.forEach((exercise, exerciseIndex) => {
                html += createExerciseCard(exercise, exerciseIndex);
            });

            // Add recovery info box for Day 6 in weeks 6-24 (Phases 2 & 3)
            if (dayNumber === 6 && appState.currentWeek >= 6) {
                html += `
                    <div class="warmup-cooldown" style="cursor: pointer; user-select: none;" onclick="toggleRecoveryInfo()">
                        <h4 id="recovery-header">
                            <span id="recovery-arrow" style="display: inline-block; transition: transform 0.2s;">‚ñ∂</span>
                            üèÉ‚Äç‚ôÇÔ∏è Active Recovery Day
                        </h4>
                        <div id="recovery-content" style="display: none; margin-top: 10px;">
                            <h4 style="margin-top: 0;">Recommended Activities (in addition to ab work):</h4>
                            <ul>
                                <li>Light cardio activities (walking, swimming, cycling)</li>
                                <li>Duration: 20-30 minutes at easy pace</li>
                                <li>Optional stretching or yoga</li>
                            </ul>
                            <h4>Benefits:</h4>
                            <ul>
                                <li>Improves circulation</li>
                                <li>Reduces muscle soreness</li>
                                <li>Maintains movement patterns</li>
                                <li>Mental relaxation</li>
                            </ul>
                        </div>
                    </div>
                `;
            }

            // Add cooldown section
            html += `
                <div class="warmup-cooldown">
                    <h4>üßò‚Äç‚ôÇÔ∏è ${GLOBAL_COOLDOWN.title}</h4>
                    <ul>
                        ${GLOBAL_COOLDOWN.exercises.map(exercise => `<li>${exercise}</li>`).join('')}
                    </ul>
                </div>
            `;

            // Add finish workout button if all exercises are complete
            const allComplete = appState.currentWorkout.exercises.every(ex => ex.currentSet >= ex.sets);
            if (allComplete) {
                html += `
                    <div class="card">
                        <div style="text-align: center;">
                            <h3>üéâ Workout Complete!</h3>
                            <p>Great job finishing today's workout. Complete your cooldown and finish the session.</p>
                            <button class="btn btn-success btn-block" onclick="finishWorkout()">
                                ‚úÖ Finish Workout
                            </button>
                        </div>
                    </div>
                `;
            }

            content.innerHTML = html;
        }

        function createExerciseCard(exercise, exerciseIndex) {
            const isCompleted = exercise.currentSet >= exercise.sets;
            const cardClass = getPhaseCardClass();

            // Get previous max and weight suggestion
            const previousMax = getPreviousMaxAndSuggestion(exercise.id, exercise.reps);
            const displayWeight = previousMax && previousMax.suggestedWeight ? previousMax.suggestedWeight : exercise.baseWeight;

            let progressionHtml = '';
            if (exercise.progression) {
                progressionHtml = `
                    <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 6px; padding: 8px; margin-bottom: 12px; font-size: 0.85rem;">
                        <strong>Progression:</strong> ${exercise.progression}
                    </div>
                `;
            }

            let loadHtml = '';
            if (exercise.load) {
                loadHtml = `
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px; padding: 6px 10px; margin-bottom: 10px; font-size: 0.8rem; color: #721c24;">
                        <strong>Load Guide:</strong> ${exercise.load}
                    </div>
                `;
            }

            // Previous max display
            let previousMaxHtml = '';
            if (previousMax && previousMax.finalSet) {
                const finalSet = previousMax.finalSet;
                previousMaxHtml = `
                    <div style="background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 6px; padding: 8px; margin-bottom: 12px; font-size: 0.85rem;">
                        <strong>Last time:</strong> Week ${previousMax.week}, Day ${previousMax.day} - ${finalSet.weight}lbs √ó ${finalSet.reps} reps @ RPE ${finalSet.rpe}
                    </div>
                `;
            }

            return `
                <div class="card workout-card ${cardClass}">
                    <div class="exercise-header">
                        <div>
                            <h3 class="exercise-name">
                                ${exercise.name}
                                ${demoLinks[exercise.id] ? `<a href="${demoLinks[exercise.id]}" target="_blank" rel="noopener noreferrer" style="margin-left: 8px; text-decoration: none; font-size: 1rem;" title="Watch demo video">‚ñ∂Ô∏è</a>` : ''}
                            </h3>
                            <div class="exercise-details">
                                ${exercise.sets} sets √ó ${exercise.reps[0]}-${exercise.reps[1]} reps ${exercise.baseWeight > 0 ? `@ ${exercise.baseWeight} lbs` : '(bodyweight)'}
                                <br>Week ${appState.currentWeek}, Day ${appState.currentDay}
                            </div>
                        </div>
                        <div class="exercise-info">
                            <div>${exercise.muscles.join(', ')}</div>
                            <div style="margin-top: 4px;">${exercise.equipment}</div>
                        </div>
                    </div>

                    ${loadHtml}
                    ${progressionHtml}
                    ${previousMaxHtml}

                    <div class="${isCompleted ? 'hidden' : ''}" id="logger-${exerciseIndex}">
                        <div class="set-info">
                            <strong>Set ${exercise.currentSet + 1} of ${exercise.sets}</strong>
                            <span>Rest: ${exercise.restTime}s</span>
                        </div>

                        ${exercise.baseWeight > 0 ? `
                            <div class="input-group">
                                <button class="btn-increment" onclick="adjustWeight(${exerciseIndex}, -2.5)">-</button>
                                <input type="number" id="weight-${exerciseIndex}" value="${displayWeight}" step="2.5" min="0">
                                <span class="unit-label">lbs</span>
                                <button class="btn-increment" onclick="adjustWeight(${exerciseIndex}, 2.5)">+</button>
                            </div>
                        ` : ''}

                        <div class="input-group">
                            <button class="btn-increment" onclick="adjustReps(${exerciseIndex}, -1)">-</button>
                            <input type="number" id="reps-${exerciseIndex}" value="${exercise.reps[1]}" min="1" max="50">
                            <span class="unit-label">reps</span>
                            <button class="btn-increment" onclick="adjustReps(${exerciseIndex}, 1)">+</button>
                        </div>

                        <div class="rpe-container">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">RPE (Rate of Perceived Exertion)</label>
                            <div class="rpe-slider">
                                <input type="range" id="rpe-${exerciseIndex}" min="6" max="10" value="8" step="0.5" 
                                       oninput="updateRPEDescription(${exerciseIndex})">
                                <div class="rpe-description" id="rpe-desc-${exerciseIndex}">Could do 2 more reps</div>
                            </div>
                        </div>

                        <button class="btn btn-success btn-block" onclick="completeSet(${exerciseIndex})">
                            ‚úÖ Complete Set
                        </button>
                        
                        <button class="btn btn-outline btn-block" onclick="startRestTimer(${exercise.restTime})">
                            ‚è±Ô∏è Start Rest Timer (${exercise.restTime}s)
                        </button>
                    </div>

                    <div class="set-history">
                        ${exercise.completedSets.map((set, i) => {
                            const setKey = `edit-${exerciseIndex}-${i}`;
                            return `
                                <div class="set-badge-container" id="set-${exerciseIndex}-${i}">
                                    <span class="set-badge completed">
                                        Set ${i + 1}: ${set.weight > 0 ? set.weight + 'lbs √ó ' : ''}${set.reps} reps (RPE ${set.rpe})
                                        <button class="edit-set-btn" onclick="editSet(${exerciseIndex}, ${i})" title="Edit set">‚úèÔ∏è</button>
                                        <button class="edit-set-btn" onclick="deleteSet(${exerciseIndex}, ${i})" title="Delete set">üóëÔ∏è</button>
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function getPhaseCardClass() {
            switch(appState.currentPhase) {
                case 2: return 'phase2-card';
                case 3: return 'phase3-card';
                default: return '';
            }
        }

        // Helper Functions
        function getCompletedSets(week, day, exerciseId) {
            const key = `${week}-${day}-${exerciseId}`;
            return appState.completedSets[key] || [];
        }

        function saveCompletedSet(week, day, exerciseId, setData) {
            const key = `${week}-${day}-${exerciseId}`;
            if (!appState.completedSets[key]) {
                appState.completedSets[key] = [];
            }
            appState.completedSets[key].push(setData);
        }

        function roundToAvailableWeight(weight, exerciseId) {
            if (weight === 0 || !weight) return 0;
            
            // Determine equipment type from exercise ID
            const exerciseName = exerciseId.toLowerCase();
            const isDumbbell = exerciseName.includes('dumbbell');
            const isBarbell = exerciseName.includes('barbell');
            
            if (isDumbbell) {
                // Dumbbells: 2.5 lb increments up to 25, then 5 lb increments
                const increment = weight <= 25 ? 2.5 : 5;
                const remainder = weight % increment;
                const threshold = increment / 2;
                
                if (remainder === 0) {
                    return weight;
                } else if (remainder >= threshold) {
                    return Math.ceil(weight / increment) * increment;
                } else {
                    return Math.floor(weight / increment) * increment;
                }
            } else if (isBarbell) {
                // Barbell: 45 lb bar + plates on both sides (10 lb increments minimum)
                // Available weights: 45, 55, 65, 75, 85, 95, 105, 115, 125... (always end in 5)
                const barWeight = 45;
                const plateIncrement = 10; // 5 lbs per side
                
                // Subtract bar weight to get plate weight
                let plateWeight = weight - barWeight;
                
                // Round plate weight to nearest 10 lbs
                const remainder = plateWeight % plateIncrement;
                const threshold = plateIncrement / 2;
                
                if (remainder === 0) {
                    plateWeight = plateWeight;
                } else if (remainder >= threshold) {
                    plateWeight = Math.ceil(plateWeight / plateIncrement) * plateIncrement;
                } else {
                    plateWeight = Math.floor(plateWeight / plateIncrement) * plateIncrement;
                }
                
                // Add bar weight back
                return barWeight + plateWeight;
            } else {
                // Bodyweight exercises or unknown - no rounding needed
                return weight;
            }
        }

        function getPreviousMaxAndSuggestion(exerciseId, targetReps) {
            // Find last time this exercise was performed (search backwards from current week/day)
            let previousData = null;
            let foundWeek = null;
            let foundDay = null;

            // Search backwards through weeks and days
            for (let w = appState.currentWeek; w >= 1; w--) {
                for (let d = 7; d >= 1; d--) {
                    // Skip current workout
                    if (w === appState.currentWeek && d === appState.currentDay) continue;
                    
                    const sets = getCompletedSets(w, d, exerciseId);
                    if (sets && sets.length > 0) {
                        previousData = sets;
                        foundWeek = w;
                        foundDay = d;
                        break;
                    }
                }
                if (previousData) break;
            }

            // Fallback: If looking for single-arm-plank-rows history and found nothing, check renegade rows history
            if ((!previousData || previousData.length === 0) && exerciseId === 'single-arm-plank-rows') {
                for (let w = appState.currentWeek; w >= 1; w--) {
                    for (let d = 7; d >= 1; d--) {
                        if (w === appState.currentWeek && d === appState.currentDay) continue;
                        
                        const sets = getCompletedSets(w, d, 'dumbbell-renegade-rows');
                        if (sets && sets.length > 0) {
                            previousData = sets;
                            foundWeek = w;
                            foundDay = d;
                            break;
                        }
                    }
                    if (previousData) break;
                }
            }

            if (!previousData || previousData.length === 0) {
                return null;
            }

            // Get final set for display
            const finalSet = previousData[previousData.length - 1];

            // Find highest weight where reps were in target range
            let highestInRangeWeight = 0;
            let setsAtHighestWeight = [];
            
            previousData.forEach(set => {
                const reps = parseInt(set.reps);
                const weight = parseFloat(set.weight);
                
                // Check if reps are in target range
                if (reps >= targetReps[0] && reps <= targetReps[1]) {
                    if (weight > highestInRangeWeight) {
                        highestInRangeWeight = weight;
                        setsAtHighestWeight = [set];
                    } else if (weight === highestInRangeWeight) {
                        setsAtHighestWeight.push(set);
                    }
                }
            });

            // Calculate suggested weight
            let suggestedWeight = highestInRangeWeight;
            
            if (highestInRangeWeight > 0 && setsAtHighestWeight.length > 0) {
                // Check if all sets at highest weight hit top of range
                const allHitTop = setsAtHighestWeight.every(set => parseInt(set.reps) === targetReps[1]);
                
                if (allHitTop) {
                    // Determine progression amount based on exercise type
                    // All barbell exercises get +5 lbs, accessories get +2.5 lbs
                    const isMainLift = exerciseId.toLowerCase().includes('barbell');
                    const progression = isMainLift ? 5 : 2.5;
                    suggestedWeight += progression;
                }
            }

            // Round suggested weight to available equipment increments
            if (suggestedWeight > 0) {
                suggestedWeight = roundToAvailableWeight(suggestedWeight, exerciseId);
            }

            return {
                week: foundWeek,
                day: foundDay,
                finalSet: finalSet,
                suggestedWeight: suggestedWeight > 0 ? suggestedWeight : null
            };
        }

        function adjustWeight(exerciseIndex, amount) {
            const input = document.getElementById(`weight-${exerciseIndex}`);
            const newValue = parseFloat(input.value) + amount;
            if (newValue >= 0) {
                input.value = newValue;
            }
        }

        function adjustReps(exerciseIndex, amount) {
            const input = document.getElementById(`reps-${exerciseIndex}`);
            const newValue = parseInt(input.value) + amount;
            if (newValue >= 1 && newValue <= 50) {
                input.value = newValue;
            }
        }

        function updateRPEDescription(exerciseIndex) {
            const rpe = parseFloat(document.getElementById(`rpe-${exerciseIndex}`).value);
            const descriptions = {
                6: "Could do 4+ more reps",
                6.5: "Could do 3-4 more reps", 
                7: "Could do 3 more reps",
                7.5: "Could do 2-3 more reps",
                8: "Could do 2 more reps",
                8.5: "Could do 1-2 more reps",
                9: "Could do 1 more rep",
                9.5: "Could maybe do 1 more",
                10: "Maximum effort"
            };
            
            document.getElementById(`rpe-desc-${exerciseIndex}`).textContent = descriptions[rpe] || "Invalid RPE";
        }

        // Core workout functions
        function completeSet(exerciseIndex) {
            if (!appState.currentWorkout || !appState.currentWorkout.exercises) {
                console.error('No current workout or exercises found');
                return;
            }

            const exercise = appState.currentWorkout.exercises[exerciseIndex];
            if (!exercise) {
                console.error('Exercise not found at index:', exerciseIndex);
                return;
            }

            const weightInput = document.getElementById(`weight-${exerciseIndex}`);
            const repsInput = document.getElementById(`reps-${exerciseIndex}`);
            const rpeInput = document.getElementById(`rpe-${exerciseIndex}`);
            
            if (!repsInput || !rpeInput) {
                console.error('Required inputs not found');
                return;
            }

            const weight = weightInput ? parseFloat(weightInput.value) || 0 : 0;
            const reps = parseInt(repsInput.value) || 0;
            const rpe = parseFloat(rpeInput.value) || 8;
            
            if (reps <= 0) {
                alert('Please enter a valid number of reps');
                return;
            }

            // Add completed set data
            const setData = {
                weight: weight,
                reps: reps,
                rpe: rpe,
                timestamp: new Date().toISOString()
            };

            // Save to app state storage ONLY (don't push to exercise.completedSets - it's the same reference!)
            saveCompletedSet(appState.currentWeek, appState.currentDay, exercise.id, setData);
            
            // Save to local storage
            saveAppState();
            
            // Debug logging - get fresh count from storage
            const currentCount = getCompletedSets(appState.currentWeek, appState.currentDay, exercise.id).length;
            console.log(`‚úÖ Set ${currentCount} completed: ${weight}lbs √ó ${reps} reps @ RPE ${rpe}`);
            console.log(`Total sets for ${exercise.name}: ${currentCount}/${exercise.sets}`);
            
            // Re-render the workout to update UI
            setTimeout(() => {
                loadWorkout();
            }, 100);
        }

        function startRestTimer(seconds) {
            const timer = document.getElementById('rest-timer');
            const timeDisplay = document.getElementById('rest-time');
            
            timer.classList.add('active');
            
            let timeLeft = seconds;
            timeDisplay.textContent = timeLeft;
            
            if (appState.restTimer) {
                clearInterval(appState.restTimer);
            }
            
            appState.restTimer = setInterval(() => {
                timeLeft--;
                timeDisplay.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(appState.restTimer);
                    timer.classList.remove('active');
                    
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200]);
                    }
                    
                    alert('Rest complete! Time for your next set.');
                }
            }, 1000);
        }

        function stopRestTimer() {
            if (appState.restTimer) {
                clearInterval(appState.restTimer);
                appState.restTimer = null;
            }
            document.getElementById('rest-timer').classList.remove('active');
        }

        function toggleRecoveryInfo() {
            const content = document.getElementById('recovery-content');
            const arrow = document.getElementById('recovery-arrow');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.style.transform = 'rotate(90deg)';
            } else {
                content.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function completeRecoveryDay() {
            const recoveryData = {
                id: `week-${appState.currentWeek}-day-${appState.currentDay}`,
                type: 'recovery',
                date: new Date().toISOString(),
                week: appState.currentWeek,
                day: appState.currentDay,
                completed: true
            };
            
            appState.workoutHistory.push(recoveryData);
            saveAppState();
            updateProgressStats();
            
            alert('Recovery day completed! Great job staying active on your recovery day!');
            
            if (appState.currentDay < 7) {
                nextDay();
            }
        }

        function completeRestDay() {
            const restData = {
                id: `week-${appState.currentWeek}-day-${appState.currentDay}`,
                type: 'rest',
                date: new Date().toISOString(),
                week: appState.currentWeek,
                day: appState.currentDay,
                completed: true
            };
            
            appState.workoutHistory.push(restData);
            saveAppState();
            updateProgressStats();
            
            alert('Rest day completed! Recovery is just as important as training!');
            
            if (appState.currentDay < 7) {
                nextDay();
            }
        }

        function finishWorkout() {
            if (!appState.currentWorkout) return;
            
            const totalSets = appState.currentWorkout.exercises.reduce((sum, ex) => sum + ex.completedSets.length, 0);
            const totalVolume = appState.currentWorkout.exercises.reduce((sum, ex) => {
                return sum + ex.completedSets.reduce((exSum, set) => exSum + (set.weight * set.reps), 0);
            }, 0);
            
            appState.currentWorkout.completed = true;
            appState.currentWorkout.completedAt = new Date().toISOString();
            appState.currentWorkout.summary = {
                totalSets: totalSets,
                totalVolume: totalVolume
            };
            
            appState.workoutHistory.push(appState.currentWorkout);
            appState.currentWorkout = null;
            
            saveAppState();
            updateProgressStats();
            
            alert(`Workout Complete! ${totalSets} sets completed with ${Math.round(totalVolume)} lbs total volume.`);
            
            document.getElementById('workout-content').innerHTML = `
                <div class="empty-state">
                    <h3>Workout Complete! üéâ</h3>
                    <p>Excellent work! Select your next workout when you're ready to train again.</p>
                    <button class="btn btn-primary" onclick="showTab('progress')">View Progress</button>
                </div>
            `;
            
            document.getElementById('workout-select').value = '';
        }

        // Progress and Stats Functions
        // Progress and Stats Functions
        let weightChart = null;
        let volumeChart = null;

        function updateProgressStats() {
            updateQuickStats();
            updatePersonalRecords();
            populateExerciseDropdown();
            updateWeightChart();
            updateVolumeChart();
            updateRecentWorkouts();
        }

        function updateQuickStats() {
            // Total Workouts
            const totalWorkouts = appState.workoutHistory.length;
            document.getElementById('stat-total-workouts').textContent = totalWorkouts;
            
            // Current Week
            document.getElementById('stat-current-week').textContent = `Week ${appState.currentWeek}`;
            
            // Consistency Rate
            const expectedWorkouts = Math.max(1, (appState.currentWeek - 1) * 5 + Math.max(0, appState.currentDay - 2));
            const actualWorkouts = appState.workoutHistory.filter(w => w.type === 'workout' || w.exercises).length;
            const consistency = Math.min(100, (actualWorkouts / expectedWorkouts * 100)) || 0;
            document.getElementById('stat-consistency').textContent = `${consistency.toFixed(0)}%`;
            
            // Total Volume (all time)
            let totalVolume = 0;
            Object.values(appState.completedSets).forEach(sets => {
                sets.forEach(set => {
                    totalVolume += (parseFloat(set.weight) || 0) * (parseInt(set.reps) || 0);
                });
            });
            document.getElementById('stat-total-volume').textContent = totalVolume > 1000 
                ? (totalVolume / 1000).toFixed(1) + 'k' 
                : Math.round(totalVolume).toLocaleString();
        }

        function calculatePersonalRecords() {
            const prs = {};
            
            // Go through all completed sets
            Object.keys(appState.completedSets).forEach(key => {
                // Key format: "week-day-exerciseId"
                const parts = key.split('-');
                if (parts.length < 3) return;
                
                const exerciseId = parts.slice(2).join('-'); // Handle exercise IDs with dashes
                const sets = appState.completedSets[key];
                
                sets.forEach(set => {
                    const weight = parseFloat(set.weight) || 0;
                    const reps = parseInt(set.reps) || 0;
                    const week = parseInt(parts[0]);
                    const day = parseInt(parts[1]);
                    
                    if (weight === 0) return; // Skip bodyweight or invalid
                    
                    if (!prs[exerciseId] || weight > prs[exerciseId].weight) {
                        prs[exerciseId] = {
                            weight: weight,
                            reps: reps,
                            week: week,
                            day: day,
                            rpe: parseFloat(set.rpe) || 0
                        };
                    }
                });
            });
            
            return prs;
        }

        function updatePersonalRecords() {
            const container = document.getElementById('personal-records-list');
            const prs = calculatePersonalRecords();
            
            if (Object.keys(prs).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>Complete workouts to track your personal records!</p>
                    </div>
                `;
                return;
            }
            
            // Sort by weight (descending) and take top 10
            const sortedPRs = Object.entries(prs)
                .sort((a, b) => b[1].weight - a[1].weight)
                .slice(0, 10);
            
            const html = sortedPRs.map(([exerciseId, pr]) => {
                const exercise = EXERCISES[exerciseId];
                const exerciseName = exercise ? exercise.name : exerciseId;
                
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: #f8f9fa; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #28a745;">
                        <div>
                            <div style="font-weight: 600; color: #343a40;">${exerciseName}</div>
                            <div style="font-size: 0.9rem; color: #6c757d;">Week ${pr.week}, Day ${pr.day}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: #28a745; font-size: 1.1rem;">${pr.weight} lbs</div>
                            <div style="font-size: 0.85rem; color: #6c757d;">${pr.reps} reps @ RPE ${pr.rpe}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function populateExerciseDropdown() {
            const select = document.getElementById('exercise-chart-select');
            const prs = calculatePersonalRecords();
            const exercisesWithData = Object.keys(prs);
            
            if (exercisesWithData.length === 0) {
                select.innerHTML = '<option value="">No exercise data yet</option>';
                return;
            }
            
            // Sort exercises alphabetically
            exercisesWithData.sort((a, b) => {
                const nameA = EXERCISES[a] ? EXERCISES[a].name : a;
                const nameB = EXERCISES[b] ? EXERCISES[b].name : b;
                return nameA.localeCompare(nameB);
            });
            
            // Set default to Barbell Bench Press if available, otherwise first exercise
            const defaultExercise = exercisesWithData.includes('barbell-bench-press') 
                ? 'barbell-bench-press' 
                : exercisesWithData[0];
            
            const options = exercisesWithData.map(exerciseId => {
                const exercise = EXERCISES[exerciseId];
                const name = exercise ? exercise.name : exerciseId;
                const selected = exerciseId === defaultExercise ? 'selected' : '';
                return `<option value="${exerciseId}" ${selected}>${name}</option>`;
            }).join('');
            
            select.innerHTML = options;
        }

        function getExerciseProgressionData(exerciseId) {
            const data = [];
            
            // Go through all weeks and days
            for (let week = 1; week <= appState.currentWeek; week++) {
                for (let day = 1; day <= 7; day++) {
                    const key = `${week}-${day}-${exerciseId}`;
                    const sets = appState.completedSets[key];
                    
                    if (sets && sets.length > 0) {
                        // Get highest weight from this workout
                        const maxWeight = Math.max(...sets.map(s => parseFloat(s.weight) || 0));
                        if (maxWeight > 0) {
                            data.push({
                                week: week,
                                day: day,
                                weight: maxWeight,
                                label: `Week ${week}, Day ${day}`
                            });
                        }
                    }
                }
            }
            
            return data;
        }

        function updateWeightChart() {
            const select = document.getElementById('exercise-chart-select');
            const exerciseId = select.value;
            
            if (!exerciseId) return;
            
            const data = getExerciseProgressionData(exerciseId);
            const ctx = document.getElementById('weight-progression-chart').getContext('2d');
            
            if (weightChart) {
                weightChart.destroy();
            }
            
            if (data.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px sans-serif';
                ctx.fillStyle = '#6c757d';
                ctx.textAlign = 'center';
                ctx.fillText('No data available for this exercise', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            const exercise = EXERCISES[exerciseId];
            const exerciseName = exercise ? exercise.name : exerciseId;
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.label),
                    datasets: [{
                        label: exerciseName + ' (lbs)',
                        data: data.map(d => d.weight),
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointBackgroundColor: '#007bff',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' lbs';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value + ' lbs';
                                }
                            }
                        }
                    }
                }
            });
        }

        function getWeeklyVolumeData() {
            const weeklyVolume = {};
            
            // Calculate volume for each week
            Object.keys(appState.completedSets).forEach(key => {
                const parts = key.split('-');
                if (parts.length < 3) return;
                
                const week = parseInt(parts[0]);
                const sets = appState.completedSets[key];
                
                if (!weeklyVolume[week]) {
                    weeklyVolume[week] = 0;
                }
                
                sets.forEach(set => {
                    const weight = parseFloat(set.weight) || 0;
                    const reps = parseInt(set.reps) || 0;
                    weeklyVolume[week] += weight * reps;
                });
            });
            
            // Convert to array and sort by week
            const data = Object.entries(weeklyVolume)
                .map(([week, volume]) => ({
                    week: parseInt(week),
                    volume: Math.round(volume)
                }))
                .sort((a, b) => a.week - b.week);
            
            // Calculate percentage changes
            data.forEach((item, index) => {
                if (index > 0) {
                    const prevVolume = data[index - 1].volume;
                    const change = ((item.volume - prevVolume) / prevVolume * 100);
                    item.change = change.toFixed(1);
                } else {
                    item.change = null;
                }
            });
            
            return data;
        }

        function updateVolumeChart() {
            const data = getWeeklyVolumeData();
            const ctx = document.getElementById('volume-chart').getContext('2d');
            
            if (volumeChart) {
                volumeChart.destroy();
            }
            
            if (data.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px sans-serif';
                ctx.fillStyle = '#6c757d';
                ctx.textAlign = 'center';
                ctx.fillText('Complete workouts to see volume tracking', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            volumeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => `Week ${d.week}`),
                    datasets: [{
                        label: 'Total Volume (lbs)',
                        data: data.map(d => d.volume),
                        backgroundColor: 'rgba(0, 123, 255, 0.8)',
                        borderColor: '#007bff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const dataIndex = context.dataIndex;
                                    const volume = context.parsed.y.toLocaleString();
                                    const change = data[dataIndex].change;
                                    if (change) {
                                        return `${volume} lbs (${change > 0 ? '+' : ''}${change}%)`;
                                    }
                                    return `${volume} lbs`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' lbs';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateRecentWorkouts() {
            const container = document.getElementById('recent-workouts');
            
            if (appState.workoutHistory.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>No workouts logged yet. Start your first workout!</p>
                    </div>
                `;
                return;
            }
            
            const recent = appState.workoutHistory
                .slice(-5)
                .reverse()
                .map(workout => {
                    const date = new Date(workout.date).toLocaleDateString();
                    
                    if (workout.type === 'recovery' || workout.type === 'rest') {
                        return `
                            <div class="workout-summary">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>${workout.type === 'recovery' ? 'üèÉ‚Äç‚ôÇÔ∏è' : 'üò¥'} ${workout.type.charAt(0).toUpperCase() + workout.type.slice(1)} Day</strong>
                                        <div style="font-size: 0.9rem; color: #6c757d;">Week ${workout.week} ‚Ä¢ ${date}</div>
                                    </div>
                                    <div style="text-align: right; font-size: 0.9rem;">
                                        <div>‚úÖ Complete</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    const sets = workout.exercises ? workout.exercises.reduce((sum, ex) => sum + ex.completedSets.length, 0) : 0;
                    const volume = workout.exercises ? workout.exercises.reduce((sum, ex) => {
                        return sum + ex.completedSets.reduce((exSum, set) => exSum + (set.weight * set.reps), 0);
                    }, 0) : 0;
                    
                    return `
                        <div class="workout-summary">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>üí™ ${workout.name}</strong>
                                    <div style="font-size: 0.9rem; color: #6c757d;">Week ${workout.week}, Day ${workout.day} ‚Ä¢ ${date}</div>
                                </div>
                                <div style="text-align: right; font-size: 0.9rem;">
                                    <div>${sets} sets</div>
                                    <div>${Math.round(volume)} lbs</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            
            container.innerHTML = recent;
        }

        // Data Management Functions
        function exportData() {
            const dataToExport = {
                appState: appState,
                exportDate: new Date().toISOString(),
                version: 'Final Production',
                programInfo: {
                    totalPhases: 3,
                    totalWeeks: 24,
                    totalExercises: Object.keys(EXERCISES).length
                }
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `muscle-builder-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('Data exported successfully!');
        }

        function exportCSV() {
            let csvContent = 'Date,Week,Day,Phase,Workout,Exercise,Set,Weight,Reps,RPE\n';
            
            appState.workoutHistory.forEach(workout => {
                if (workout.exercises) {
                    workout.exercises.forEach(exercise => {
                        exercise.completedSets.forEach((set, setIndex) => {
                            const exerciseName = EXERCISES[exercise.id]?.name || exercise.id;
                            csvContent += `${workout.date.split('T')[0]},${workout.week},${workout.day},${workout.phase},"${workout.name}","${exerciseName}",${setIndex + 1},${set.weight},${set.reps},${set.rpe}\n`;
                        });
                    });
                }
            });
            
            const csvBlob = new Blob([csvContent], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(csvBlob);
            link.download = `muscle-builder-data-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            alert('CSV exported successfully!');
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL data? This cannot be undone.')) {
                if (confirm('Last chance - this will permanently delete everything!')) {
                    localStorage.removeItem('muscleBuilderApp');
                    
                    appState = {
                        currentWeek: 1,
                        currentDay: 1,
                        currentPhase: 1,
                        workoutHistory: [],
                        currentWorkout: null,
                        restTimer: null,
                        completedSets: {},
                        startDate: null
                    };
                    
                    updateHeaderInfo();
                    updatePhaseInfo();
                    populateWorkoutSelect();
                    updateProgressStats();
                    loadWorkout();
                    
                    alert('All data cleared successfully!');
                }
            }
        }

        // Edit and Delete Set Functions
        function editSet(exerciseIndex, setIndex) {
            if (!appState.currentWorkout || !appState.currentWorkout.exercises) {
                console.error('No current workout loaded');
                return;
            }

            const exercise = appState.currentWorkout.exercises[exerciseIndex];
            const set = exercise.completedSets[setIndex];
            
            const container = document.getElementById(`set-${exerciseIndex}-${setIndex}`);
            if (!container) return;

            // Create edit UI
            container.innerHTML = `
                <div class="set-edit-mode">
                    <div style="font-size: 0.85rem; margin-bottom: 8px; font-weight: 600;">Edit Set ${setIndex + 1}</div>
                    <div class="set-edit-inputs">
                        ${set.weight > 0 ? `
                            <div>
                                <label style="font-size: 0.75rem; color: #6c757d;">Weight (lbs)</label>
                                <input type="number" id="edit-weight-${exerciseIndex}-${setIndex}" class="set-edit-input" value="${set.weight}" step="2.5" min="0">
                            </div>
                        ` : ''}
                        <div>
                            <label style="font-size: 0.75rem; color: #6c757d;">Reps</label>
                            <input type="number" id="edit-reps-${exerciseIndex}-${setIndex}" class="set-edit-input" value="${set.reps}" min="1" max="50">
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; color: #6c757d;">RPE</label>
                            <input type="number" id="edit-rpe-${exerciseIndex}-${setIndex}" class="set-edit-input" value="${set.rpe}" min="6" max="10" step="0.5">
                        </div>
                    </div>
                    <div class="set-edit-actions">
                        <button class="btn btn-success btn-small" onclick="saveSetEdit(${exerciseIndex}, ${setIndex})">‚úì Save</button>
                        <button class="btn btn-secondary btn-small" onclick="cancelSetEdit(${exerciseIndex}, ${setIndex})">‚úó Cancel</button>
                    </div>
                </div>
            `;
        }

        function saveSetEdit(exerciseIndex, setIndex) {
            if (!appState.currentWorkout || !appState.currentWorkout.exercises) {
                console.error('No current workout loaded');
                return;
            }

            const exercise = appState.currentWorkout.exercises[exerciseIndex];
            const weightInput = document.getElementById(`edit-weight-${exerciseIndex}-${setIndex}`);
            const repsInput = document.getElementById(`edit-reps-${exerciseIndex}-${setIndex}`);
            const rpeInput = document.getElementById(`edit-rpe-${exerciseIndex}-${setIndex}`);

            if (!repsInput || !rpeInput) {
                console.error('Edit inputs not found');
                return;
            }

            const newWeight = weightInput ? parseFloat(weightInput.value) || 0 : 0;
            const newReps = parseInt(repsInput.value) || 0;
            const newRpe = parseFloat(rpeInput.value) || 8;

            if (newReps <= 0) {
                alert('Reps must be greater than 0');
                return;
            }

            if (newRpe < 6 || newRpe > 10) {
                alert('RPE must be between 6 and 10');
                return;
            }

            // Update the set data
            exercise.completedSets[setIndex] = {
                weight: newWeight,
                reps: newReps,
                rpe: newRpe,
                timestamp: exercise.completedSets[setIndex].timestamp, // Keep original timestamp
                edited: true,
                editedAt: new Date().toISOString()
            };

            // Update in storage
            const key = `${appState.currentWeek}-${appState.currentDay}-${exercise.id}`;
            appState.completedSets[key] = exercise.completedSets;

            // Save to localStorage
            saveAppState();

            console.log(`‚úèÔ∏è Set ${setIndex + 1} edited: ${newWeight}lbs √ó ${newReps} reps @ RPE ${newRpe}`);

            // Reload workout to show changes
            loadWorkout();
        }

        function cancelSetEdit(exerciseIndex, setIndex) {
            // Simply reload the workout to restore original display
            loadWorkout();
        }

        function deleteSet(exerciseIndex, setIndex) {
            if (!appState.currentWorkout || !appState.currentWorkout.exercises) {
                console.error('No current workout loaded');
                return;
            }

            const exercise = appState.currentWorkout.exercises[exerciseIndex];
            if (!exercise || !exercise.completedSets[setIndex]) {
                console.error('Set not found');
                return;
            }

            const set = exercise.completedSets[setIndex];

            // Confirmation
            const confirmMsg = `Delete Set ${setIndex + 1}?\n\n${set.weight > 0 ? set.weight + 'lbs √ó ' : ''}${set.reps} reps (RPE ${set.rpe})\n\nThis cannot be undone.`;
            
            if (!confirm(confirmMsg)) {
                return;
            }

            // Remove the set from the array
            exercise.completedSets.splice(setIndex, 1);

            // Update in storage
            const key = `${appState.currentWeek}-${appState.currentDay}-${exercise.id}`;
            appState.completedSets[key] = exercise.completedSets;

            // If no sets left for this exercise, remove the key entirely
            if (exercise.completedSets.length === 0) {
                delete appState.completedSets[key];
            }

            // Save to localStorage
            saveAppState();

            console.log(`üóëÔ∏è Set ${setIndex + 1} deleted from ${exercise.name}`);

            // Reload workout to show changes
            loadWorkout();
        }

        // Import Data Functions
        let pendingImportData = null;

        function showImportModal() {
            document.getElementById('import-modal').classList.add('active');
            // Reset modal state
            switchImportTab('file');
            document.getElementById('import-file-input').value = '';
            document.getElementById('import-paste-input').value = '';
            document.getElementById('import-file-preview').innerHTML = '';
            document.getElementById('import-paste-preview').innerHTML = '';
            document.getElementById('import-confirmation').classList.add('hidden');
            pendingImportData = null;
        }

        function closeImportModal() {
            document.getElementById('import-modal').classList.remove('active');
            pendingImportData = null;
        }

        function switchImportTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.import-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.import-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tabName === 'file') {
                document.getElementById('import-file-tab').classList.add('active');
            } else if (tabName === 'paste') {
                document.getElementById('import-paste-tab').classList.add('active');
            }

            // Hide confirmation
            document.getElementById('import-confirmation').classList.add('hidden');
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const fileExtension = file.name.split('.').pop().toLowerCase();

                    if (fileExtension === 'json') {
                        const data = JSON.parse(content);
                        validateAndPreviewImport(data, 'json');
                    } else if (fileExtension === 'csv') {
                        parseCSVAndPreview(content);
                    } else {
                        alert('Unsupported file type. Please upload a JSON or CSV file.');
                    }
                } catch (error) {
                    console.error('Error reading file:', error);
                    alert('Error reading file. Please ensure it\'s a valid JSON or CSV file exported from this app.');
                }
            };
            reader.readAsText(file);
        }

        function handlePasteImport() {
            const content = document.getElementById('import-paste-input').value.trim();
            if (!content) {
                alert('Please paste JSON data first.');
                return;
            }

            try {
                const data = JSON.parse(content);
                validateAndPreviewImport(data, 'json');
            } catch (error) {
                console.error('Error parsing JSON:', error);
                alert('Invalid JSON format. Please paste valid JSON data exported from this app.');
            }
        }

        function parseCSVAndPreview(csvContent) {
            const lines = csvContent.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                alert('CSV file appears to be empty.');
                return;
            }

            // Parse CSV into workout data structure
            const headers = lines[0].split(',');
            const workoutData = {};
            const workoutHistory = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length < 10) continue;

                const [date, week, day, phase, workout, exercise, set, weight, reps, rpe] = values;
                
                const key = `${week}-${day}-${exercise.replace(/"/g, '')}`;
                if (!workoutData[key]) {
                    workoutData[key] = [];
                }

                workoutData[key].push({
                    weight: parseFloat(weight) || 0,
                    reps: parseInt(reps) || 0,
                    rpe: parseFloat(rpe) || 8,
                    timestamp: date
                });
            }

            const importData = {
                appState: {
                    completedSets: workoutData,
                    workoutHistory: []
                }
            };

            validateAndPreviewImport(importData, 'csv');
        }

        function validateAndPreviewImport(data, format) {
            try {
                // Validate data structure
                if (!data.appState && !data.completedSets && !data.workoutHistory) {
                    alert('Invalid data format. Expected exported data from this app.');
                    return;
                }

                // Extract the relevant data
                const importState = data.appState || data;
                const setsToImport = importState.completedSets || {};
                const historyToImport = importState.workoutHistory || [];

                // Count data
                const totalSets = Object.values(setsToImport).reduce((sum, sets) => sum + sets.length, 0);
                const totalWorkouts = historyToImport.length;

                // Store for confirmation
                pendingImportData = {
                    completedSets: setsToImport,
                    workoutHistory: historyToImport
                };

                // Show preview
                const summary = `
                    <div style="background: white; padding: 16px; border-radius: 6px; margin-bottom: 12px;">
                        <p style="margin: 8px 0;"><strong>Format:</strong> ${format.toUpperCase()}</p>
                        <p style="margin: 8px 0;"><strong>Workouts:</strong> ${totalWorkouts}</p>
                        <p style="margin: 8px 0;"><strong>Total Sets:</strong> ${totalSets}</p>
                        <p style="margin: 8px 0; color: #28a745;"><strong>Status:</strong> ‚úì Valid data</p>
                    </div>
                    <div style="background: #fff3cd; padding: 12px; border-radius: 6px; font-size: 0.9rem;">
                        <strong>Note:</strong> This will merge with your existing data. No data will be overwritten.
                    </div>
                `;

                document.getElementById('import-summary').innerHTML = summary;
                document.getElementById('import-confirmation').classList.remove('hidden');

            } catch (error) {
                console.error('Validation error:', error);
                alert('Error validating import data: ' + error.message);
            }
        }

        function confirmImport() {
            if (!pendingImportData) {
                alert('No data to import.');
                return;
            }

            try {
                // Merge with existing data
                const existingSets = appState.completedSets || {};
                const existingHistory = appState.workoutHistory || [];

                // Merge completed sets (don't overwrite, add new keys)
                Object.keys(pendingImportData.completedSets).forEach(key => {
                    if (!existingSets[key]) {
                        existingSets[key] = pendingImportData.completedSets[key];
                    } else {
                        // Merge sets for same key (avoid duplicates by timestamp)
                        const existingTimestamps = existingSets[key].map(s => s.timestamp);
                        pendingImportData.completedSets[key].forEach(set => {
                            if (!existingTimestamps.includes(set.timestamp)) {
                                existingSets[key].push(set);
                            }
                        });
                    }
                });

                // Merge workout history (avoid duplicates by id)
                const existingIds = existingHistory.map(w => w.id);
                pendingImportData.workoutHistory.forEach(workout => {
                    if (!existingIds.includes(workout.id)) {
                        existingHistory.push(workout);
                    }
                });

                // Update app state
                appState.completedSets = existingSets;
                appState.workoutHistory = existingHistory;

                // Save to localStorage
                saveAppState();

                // Update UI
                updateProgressStats();

                // Success message
                const totalSets = Object.values(pendingImportData.completedSets).reduce((sum, sets) => sum + sets.length, 0);
                const totalWorkouts = pendingImportData.workoutHistory.length;

                alert(`‚úÖ Import Successful!\n\n${totalWorkouts} workouts and ${totalSets} sets imported.`);

                // Close modal
                closeImportModal();

                console.log('‚úÖ Data imported successfully');

            } catch (error) {
                console.error('Import error:', error);
                alert('Error importing data: ' + error.message);
            }
        }

        function cancelImport() {
            pendingImportData = null;
            document.getElementById('import-confirmation').classList.add('hidden');
        }

        // Local Storage Functions
        function saveAppState() {
            try {
                localStorage.setItem('muscleBuilderApp', JSON.stringify(appState));
            } catch (error) {
                console.error('Failed to save app state:', error);
            }
        }

        function loadAppState() {
            try {
                const saved = localStorage.getItem('muscleBuilderApp');
                if (saved) {
                    const loadedState = JSON.parse(saved);
                    appState = { ...appState, ...loadedState };
                }
            } catch (error) {
                console.error('Failed to load app state:', error);
                // Reset to default state if corrupted
                appState = {
                    currentWeek: 1,
                    currentDay: 1,
                    currentPhase: 1,
                    workoutHistory: [],
                    currentWorkout: null,
                    restTimer: null,
                    completedSets: {},
                    startDate: null
                };
            }
        }

        // Initialize App
        async function initApp() {
            try {
                // Load demo video links
                await loadDemoLinks();
                
                loadAppState();
                
                // Set start date if first time user
                if (!appState.startDate) {
                    appState.startDate = new Date().toISOString();
                    saveAppState();
                }
                
                updateHeaderInfo();
                updatePhaseInfo();
                populateWorkoutSelect();
                populateWeekSelect();
                populateDaySelect();
                updateProgressStats();
                
                // Show welcome message for new users
                if (appState.workoutHistory.length === 0) {
                    setTimeout(() => {
                        alert('Welcome to your 24-Week Muscle Builder journey! üí™\n\nStart with Week 1, Day 1 to begin your transformation. Remember:\n\n‚úÖ Focus on form over weight\n‚úÖ Use the RPE scale honestly\n‚úÖ Follow rest times\n‚úÖ Track every set\n\nYou\'ve got this!');
                    }, 1000);
                }
                
                console.log('24-Week Muscle Builder - Final Production Version initialized successfully');
                console.log('Current Phase:', appState.currentPhase);
                console.log('Current Week:', appState.currentWeek);
                console.log('Total exercises available:', Object.keys(EXERCISES).length);
                console.log('Demo links loaded:', Object.keys(demoLinks).length);
                console.log('Start date:', appState.startDate);
            } catch (error) {
                console.error('Failed to initialize app:', error);
            }
        }

        // Service Worker Registration with Cache Versioning
        const CACHE_VERSION = 'v0.2.1'; // UPDATE THIS VERSION WHEN YOU PUSH CHANGES
        
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                // Register inline service worker with cache versioning
                const swCode = `
                    const CACHE_NAME = '${CACHE_VERSION}';
                    const urlsToCache = [
                        '/',
                        '/index.html',
                        '/demo-links.json'
                    ];
        
                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                                .then(() => self.skipWaiting())
                        );
                    });
        
                    self.addEventListener('activate', (event) => {
                        event.waitUntil(
                            caches.keys().then((cacheNames) => {
                                return Promise.all(
                                    cacheNames.map((cacheName) => {
                                        if (cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            }).then(() => self.clients.claim())
                        );
                    });
        
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            fetch(event.request)
                                .then((response) => {
                                    const responseClone = response.clone();
                                    caches.open(CACHE_NAME).then((cache) => {
                                        cache.put(event.request, responseClone);
                                    });
                                    return response;
                                })
                                .catch(() => caches.match(event.request))
                        );
                    });
                `;
        
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
        
                try {
                    const registration = await navigator.serviceWorker.register(swUrl);
                    console.log('SW registered with version:', CACHE_VERSION);
                    
                    // Auto-update when new version detected
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'activated' && navigator.serviceWorker.controller) {
                                console.log('New version available! Reloading...');
                                window.location.reload();
                            }
                        });
                    });
                } catch (error) {
                    console.log('SW registration failed:', error);
                }
            });
        }

        // Event Listeners and App Initialization
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('import-modal');
            if (e.target === modal) {
                closeImportModal();
            }
        });
        
        // Auto-save every 30 seconds
        setInterval(saveAppState, 30000);
        
        // Save on page unload
        window.addEventListener('beforeunload', saveAppState);
        
        // Handle back button navigation
        window.addEventListener('popstate', function(e) {
            // Prevent accidental navigation away from workout
            if (appState.currentWorkout && !confirm('Are you sure you want to leave? Your current workout progress will be saved.')) {
                history.pushState(null, null, window.location.href);
            }
        });

        // Add touch and mobile optimizations
        document.addEventListener('touchstart', function() {}, { passive: true });
        
        // Prevent zoom on input focus (mobile)
        document.addEventListener('touchend', function(e) {
            if (e.target.tagName === 'INPUT') {
                e.target.blur();
                setTimeout(() => e.target.focus(), 100);
            }
        });

        // Quick access functions for debugging/testing
        window.MuscleBuilderApp = {
            getAppState: () => appState,
            jumpToWeek: (week) => {
                if (week >= 1 && week <= 24) {
                    appState.currentWeek = week;
                    appState.currentDay = 1;
                    updateHeaderInfo();
                    updatePhaseInfo();
                    populateWorkoutSelect();
                    populateDaySelect();
                    loadWorkout();
                    saveAppState();
                    console.log(`Jumped to Week ${week}`);
                } else {
                    console.error('Week must be between 1 and 24');
                }
            },
            exportState: () => {
                console.log('Current app state:', JSON.stringify(appState, null, 2));
                return appState;
            },
            getExerciseList: () => Object.keys(EXERCISES),
            resetApp: clearAllData
        };

        console.log('üöÄ 24-Week Muscle Builder - Final Production Version Ready!');
        console.log('üí° Quick tip: Use the browser console with MuscleBuilderApp.jumpToWeek(X) for testing');
    </script>
</body>
</html>
